<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–£–ù–ö–ï–† ‚Ä¢ –û–Ω–ª–∞–π–Ω –ì—Ä–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@300;500;700&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #ff6b35;
            --danger: #d32f2f;
            --dark: #1a1a1a;
            --darker: #0d0d0d;
            --light: #f5f5f5;
            --accent: #ffd23f;
            --bunker-green: #3bba5c;
            --metal: #5a6473;
        }

        body {
            font-family: 'Oswald', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, #2a1a0a 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(0deg, rgba(0,0,0,0.1) 0px, transparent 1px, transparent 2px, rgba(0,0,0,0.1) 3px),
                radial-gradient(circle at 20% 50%, rgba(255, 107, 53, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 210, 63, 0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            border-bottom: 3px solid var(--primary);
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 3px;
            background: var(--accent);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: translateX(-50%) scaleX(1); }
            50% { opacity: 0.5; transform: translateX(-50%) scaleX(0.8); }
        }

        h1 {
            font-family: 'Bebas Neue', cursive;
            font-size: 5rem;
            letter-spacing: 8px;
            color: var(--primary);
            text-shadow: 4px 4px 0 rgba(0,0,0,0.5), 0 0 30px rgba(255, 107, 53, 0.3);
            margin-bottom: 10px;
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--accent);
            letter-spacing: 3px;
            font-weight: 300;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(26, 26, 26, 0.95);
            border: 2px solid var(--metal);
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            opacity: 0.7;
        }

        .btn {
            background: linear-gradient(135deg, var(--primary), #ff8c5a);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-family: 'Oswald', sans-serif;
            font-weight: 500;
            letter-spacing: 2px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(255, 107, 53, 0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--metal), #6b7784);
            box-shadow: 0 5px 20px rgba(90, 100, 115, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #e57373);
            box-shadow: 0 5px 20px rgba(211, 47, 47, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--bunker-green), #4caf50);
            box-shadow: 0 5px 20px rgba(59, 186, 92, 0.3);
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-family: 'Courier Prime', monospace;
            background: rgba(13, 13, 13, 0.8);
            border: 2px solid var(--metal);
            border-radius: 8px;
            color: var(--light);
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
        }

        .room-code {
            font-family: 'Courier Prime', monospace;
            font-size: 2.5rem;
            color: var(--accent);
            background: rgba(13, 13, 13, 0.8);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            letter-spacing: 8px;
            margin: 20px 0;
            border: 2px solid var(--accent);
            box-shadow: 0 0 30px rgba(255, 210, 63, 0.2);
            font-weight: bold;
        }

        .share-link {
            background: rgba(13, 13, 13, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--bunker-green);
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .share-link input {
            flex: 1;
            margin: 0;
            background: transparent;
            border: none;
            color: var(--bunker-green);
            font-size: 0.95rem;
        }

        .share-link input:focus {
            box-shadow: none;
        }

        .copy-btn {
            padding: 10px 20px;
            font-size: 0.9rem;
        }

        .player-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .player-item {
            background: rgba(13, 13, 13, 0.6);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--bunker-green);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .player-item:hover {
            transform: translateX(5px);
            background: rgba(13, 13, 13, 0.8);
        }

        .player-item.eliminated {
            opacity: 0.5;
            border-left-color: var(--danger);
            text-decoration: line-through;
        }

        .player-item.host::before {
            content: 'üëë';
            font-size: 1.2rem;
        }

        .character-card {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.95), rgba(42, 26, 10, 0.95));
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 25px;
            margin: 15px 0;
            box-shadow: 0 10px 40px rgba(255, 107, 53, 0.2);
        }

        .characteristic {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 15px;
            margin: 12px 0;
            padding: 12px;
            background: rgba(13, 13, 13, 0.4);
            border-radius: 6px;
            align-items: center;
            transition: all 0.3s ease;
        }

        .characteristic:hover {
            background: rgba(13, 13, 13, 0.6);
            transform: translateX(5px);
        }

        .characteristic-label {
            color: var(--accent);
            font-weight: 500;
            font-size: 0.95rem;
            letter-spacing: 1px;
        }

        .characteristic-value {
            color: var(--light);
            font-size: 1.05rem;
            font-weight: 300;
        }

        .hidden {
            filter: blur(8px);
            user-select: none;
            cursor: not-allowed;
        }

        .scenario-card {
            background: linear-gradient(135deg, rgba(211, 47, 47, 0.2), rgba(255, 107, 53, 0.2));
            border: 3px solid var(--danger);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }

        .scenario-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 2rem;
            color: var(--danger);
            margin-bottom: 15px;
            letter-spacing: 3px;
        }

        .scenario-desc {
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--light);
        }

        .bunker-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .bunker-stat {
            background: rgba(13, 13, 13, 0.6);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border-top: 3px solid var(--bunker-green);
        }

        .bunker-stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--bunker-green);
            font-family: 'Bebas Neue', cursive;
        }

        .bunker-stat-label {
            font-size: 0.9rem;
            color: var(--metal);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 5px;
        }

        .timer {
            font-family: 'Courier Prime', monospace;
            font-size: 3rem;
            color: var(--accent);
            text-align: center;
            padding: 20px;
            background: rgba(13, 13, 13, 0.8);
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid var(--accent);
            font-weight: bold;
            letter-spacing: 5px;
        }

        .timer.warning {
            color: var(--primary);
            border-color: var(--primary);
            animation: timerPulse 1s ease-in-out infinite;
        }

        .timer.critical {
            color: var(--danger);
            border-color: var(--danger);
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .chat-container {
            background: rgba(13, 13, 13, 0.8);
            border: 2px solid var(--metal);
            border-radius: 12px;
            padding: 20px;
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .chat-message {
            margin: 8px 0;
            padding: 10px;
            background: rgba(26, 26, 26, 0.6);
            border-radius: 6px;
            border-left: 3px solid var(--primary);
            animation: slideInLeft 0.3s ease-out;
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .chat-message.system {
            border-left-color: var(--accent);
            background: rgba(255, 210, 63, 0.1);
        }

        .chat-message-author {
            color: var(--accent);
            font-weight: 500;
            margin-bottom: 5px;
        }

        .chat-message-text {
            color: var(--light);
            font-weight: 300;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            margin: 0;
        }

        .vote-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .vote-option {
            background: rgba(13, 13, 13, 0.6);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid var(--metal);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .vote-option:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
        }

        .vote-option.selected {
            border-color: var(--bunker-green);
            background: rgba(59, 186, 92, 0.2);
        }

        .vote-option.eliminated {
            border-color: var(--danger);
            background: rgba(211, 47, 47, 0.2);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .event-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, rgba(211, 47, 47, 0.98), rgba(255, 107, 53, 0.98));
            border: 4px solid var(--accent);
            border-radius: 16px;
            padding: 40px;
            max-width: 600px;
            z-index: 1000;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .event-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .event-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 2.5rem;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            letter-spacing: 3px;
        }

        .event-description {
            font-size: 1.2rem;
            color: white;
            text-align: center;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        .phase-indicator {
            text-align: center;
            font-family: 'Bebas Neue', cursive;
            font-size: 1.8rem;
            color: var(--accent);
            margin: 20px 0;
            padding: 15px;
            background: rgba(13, 13, 13, 0.6);
            border-radius: 8px;
            letter-spacing: 3px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .status-message {
            text-align: center;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-size: 1.1rem;
            animation: fadeIn 0.5s ease-out;
        }

        .status-message.info {
            background: rgba(59, 186, 92, 0.2);
            border: 2px solid var(--bunker-green);
            color: var(--bunker-green);
        }

        .status-message.warning {
            background: rgba(255, 210, 63, 0.2);
            border: 2px solid var(--accent);
            color: var(--accent);
        }

        .vote-result {
            background: rgba(211, 47, 47, 0.3);
            border: 2px solid var(--danger);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }

        .vote-result-text {
            font-size: 1.5rem;
            color: var(--danger);
            font-weight: 500;
            margin-bottom: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--accent);
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 3rem;
            }
            
            .room-code {
                font-size: 1.8rem;
                letter-spacing: 4px;
            }
            
            .timer {
                font-size: 2rem;
            }
            
            .characteristic {
                grid-template-columns: 1fr;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–ë–£–ù–ö–ï–†</h1>
            <div class="subtitle">–•—Ç–æ –∑–∞—Å–ª—É–≥–æ–≤—É—î –≤–∏–∂–∏—Ç–∏?</div>
        </div>

        <!-- –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é -->
        <div id="menuScreen" class="screen active">
            <div class="card">
                <h2 style="text-align: center; font-size: 2rem; margin-bottom: 30px; color: var(--primary);">–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é</h2>
                <div class="action-buttons">
                    <button class="btn" onclick="showCreateRoom()">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫—ñ–º–Ω–∞—Ç—É</button>
                    <button class="btn btn-secondary" onclick="showJoinRoom()">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ –∫—ñ–º–Ω–∞—Ç–∏</button>
                    <button class="btn btn-secondary" onclick="showAISettings()">‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è AI</button>
                </div>
                
                <div style="margin-top: 40px; padding: 20px; background: rgba(13, 13, 13, 0.4); border-radius: 8px;">
                    <h3 style="color: var(--accent); margin-bottom: 15px;">–Ø–∫ –≥—Ä–∞—Ç–∏:</h3>
                    <ul style="line-height: 1.8; color: var(--light); font-weight: 300; list-style-position: inside;">
                        <li>–°—Ç–≤–æ—Ä–∏ –∫—ñ–º–Ω–∞—Ç—É —Ç–∞ –ø–æ–¥—ñ–ª–∏—Å—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –∑ –¥—Ä—É–∑—è–º–∏</li>
                        <li>–ö–æ–∂–µ–Ω –≥—Ä–∞–≤–µ—Ü—å –æ—Ç—Ä–∏–º–∞—î –≤–∏–ø–∞–¥–∫–æ–≤–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂</li>
                        <li>–ü–µ—Ä–µ–∫–æ–Ω–∞–π —ñ–Ω—à–∏—Ö, —á–æ–º—É —Å–∞–º–µ —Ç–∏ –º–∞—î—à –ø–æ—Ç—Ä–∞–ø–∏—Ç–∏ –≤ –±—É–Ω–∫–µ—Ä</li>
                        <li>–í –±—É–Ω–∫–µ—Ä—ñ –æ–±–º–µ–∂–µ–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—Ü—å</li>
                        <li>–ì–æ–ª–æ—Å—É–π—Ç–µ –∑–∞ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è –Ω–∞–π–º–µ–Ω—à –∫–æ—Ä–∏—Å–Ω–∏—Ö –≥—Ä–∞–≤—Ü—ñ–≤</li>
                        <li>–ü—ñ–¥ —á–∞—Å –≥—Ä–∏ –º–æ–∂—É—Ç—å —Ç—Ä–∞–ø–∏—Ç–∏—Å—è –≤–∏–ø–∞–¥–∫–æ–≤—ñ –ø–æ–¥—ñ—ó</li>
                    </ul>
                </div>
                
                <div id="aiStatusIndicator" style="margin-top: 20px; padding: 15px; background: rgba(255, 210, 63, 0.2); border: 2px solid var(--accent); border-radius: 8px; text-align: center;">
                    <div style="color: var(--accent); font-weight: 500;">AI –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ</div>
                    <div style="color: var(--light); font-size: 0.9rem; margin-top: 5px;">–ë–µ–∑ AI –∫–ª—é—á–∞ - –±–∞–∑–æ–≤—ñ —Ç–µ–∫—Å—Ç–∏ –∑–∞–º—ñ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó</div>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å AI -->
        <div id="aiSettingsScreen" class="screen">
            <div class="card">
                <h2 style="text-align: center; font-size: 2rem; margin-bottom: 30px; color: var(--primary);">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è AI</h2>
                
                <div style="margin-bottom: 30px; padding: 20px; background: rgba(59, 186, 92, 0.1); border: 2px solid var(--bunker-green); border-radius: 8px;">
                    <h3 style="color: var(--bunker-green); margin-bottom: 15px;">ü§ñ –ù–∞–≤—ñ—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω AI?</h3>
                    <p style="color: var(--light); line-height: 1.6; margin-bottom: 10px;">
                        AI –≥–µ–Ω–µ—Ä—É—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –∫–æ–∂–Ω–æ—ó –ø–∞—Ä—Ç—ñ—ó:
                    </p>
                    <ul style="color: var(--light); line-height: 1.8; list-style-position: inside;">
                        <li>–î—Ä–∞–º–∞—Ç–∏—á–Ω—ñ —Å—Ü–µ–Ω–∏ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è –≥—Ä–∞–≤—Ü—ñ–≤</li>
                        <li>–í–∏–ø–∞–¥–∫–æ–≤—ñ –ø–æ–¥—ñ—ó, –ø—Ä–∏–≤'—è–∑–∞–Ω—ñ –¥–æ —Å—Ü–µ–Ω–∞—Ä—ñ—é</li>
                        <li>–ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—É –∫—ñ–Ω—Ü—ñ–≤–∫—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤–∏–∂–∏–≤—à–∏—Ö</li>
                    </ul>
                    <p style="color: var(--accent); margin-top: 15px; font-size: 0.95rem;">
                        üí° –ë–µ–∑ AI –≥—Ä–∞ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ –∑ –±–∞–∑–æ–≤–∏–º–∏ –∑–∞–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏
                    </p>
                </div>

                <div style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px; color: var(--accent); font-weight: 500;">–û–±–µ—Ä—ñ—Ç—å AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:</label>
                    <select id="aiProviderSelect" onchange="window.updateAIProvider()" style="width: 100%; padding: 15px; font-size: 1.1rem; background: rgba(13, 13, 13, 0.8); border: 2px solid var(--metal); border-radius: 8px; color: var(--light); font-family: 'Oswald', sans-serif;">
                        <option value="none">–ë–µ–∑ AI (–±–∞–∑–æ–≤—ñ —Ç–µ–∫—Å—Ç–∏)</option>
                        <option value="gemini">Google Gemini (–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ)</option>
                        <option value="openai">OpenAI ChatGPT</option>
                    </select>
                </div>

                <div id="aiKeySection" style="display: none; margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px; color: var(--accent); font-weight: 500;">API –ö–ª—é—á:</label>
                    <input type="password" id="aiKeyInput" placeholder="–í—Å—Ç–∞–≤—Ç–µ –≤–∞—à API –∫–ª—é—á" style="font-family: 'Courier Prime', monospace;">
                    
                    <div id="aiInstructions" style="margin-top: 15px; padding: 15px; background: rgba(13, 13, 13, 0.4); border-radius: 8px; font-size: 0.9rem; color: var(--light); line-height: 1.6;">
                        <!-- –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –±—É–¥—É—Ç—å —Ç—É—Ç -->
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-success" onclick="saveAISettings()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                    <button class="btn btn-secondary" onclick="showMenu()">–ù–∞–∑–∞–¥</button>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—ñ–º–Ω–∞—Ç–∏ -->
        <div id="createRoomScreen" class="screen">
            <div class="card">
                <h2 style="text-align: center; font-size: 2rem; margin-bottom: 30px; color: var(--primary);">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫—ñ–º–Ω–∞—Ç—É</h2>
                <input type="text" id="hostNameInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è" maxlength="20">
                <div style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px; color: var(--accent);">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥—Ä–∞–≤—Ü—ñ–≤:</label>
                    <input type="number" id="maxPlayersInput" min="4" max="8" value="6" style="width: 100%;">
                </div>
                <div style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px; color: var(--accent);">–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è (—Ö–≤–∏–ª–∏–Ω):</label>
                    <input type="number" id="discussionTimeInput" min="1" max="15" value="5" style="width: 100%;">
                </div>
                <div class="action-buttons">
                    <button class="btn" onclick="createRoom()">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
                    <button class="btn btn-secondary" onclick="showMenu()">–ù–∞–∑–∞–¥</button>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –¥–æ –∫—ñ–º–Ω–∞—Ç–∏ -->
        <div id="joinRoomScreen" class="screen">
            <div class="card">
                <h2 style="text-align: center; font-size: 2rem; margin-bottom: 30px; color: var(--primary);">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ –∫—ñ–º–Ω–∞—Ç–∏</h2>
                <input type="text" id="playerNameInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è" maxlength="20">
                <input type="text" id="roomCodeInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏ (4 —Å–∏–º–≤–æ–ª–∏)" maxlength="4" style="text-transform: uppercase;">
                <div class="action-buttons">
                    <button class="btn" onclick="joinRoom()">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è</button>
                    <button class="btn btn-secondary" onclick="showMenu()">–ù–∞–∑–∞–¥</button>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è (–ª–æ–±—ñ) -->
        <div id="lobbyScreen" class="screen">
            <div class="card">
                <h2 style="text-align: center; font-size: 2rem; margin-bottom: 20px; color: var(--primary);">–ö—ñ–º–Ω–∞—Ç–∞</h2>
                <div class="room-code" id="roomCodeDisplay"></div>
                
                <div class="share-link">
                    <input type="text" id="shareLinkInput" readonly>
                    <button class="btn copy-btn" onclick="copyShareLink()">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <div class="status-message info">
                        <span id="playerCountDisplay"></span>
                    </div>
                </div>

                <h3 style="color: var(--accent); margin: 20px 0;">–ì—Ä–∞–≤—Ü—ñ –≤ –∫—ñ–º–Ω–∞—Ç—ñ:</h3>
                <div class="player-list" id="lobbyPlayerList"></div>

                <div class="action-buttons" id="lobbyActions"></div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –≥—Ä–∏ -->
        <div id="gameScreen" class="screen">
            <div class="phase-indicator" id="phaseIndicator">–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞...</div>
            
            <div id="timerContainer" style="display: none;">
                <div class="timer" id="gameTimer">05:00</div>
            </div>

            <div class="grid-2">
                <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å—Ü–µ–Ω–∞—Ä—ñ–π -->
                <div>
                    <div class="scenario-card" id="scenarioCard"></div>
                    <div class="bunker-info" id="bunkerInfo"></div>
                </div>

                <!-- –ß–∞—Ç -->
                <div>
                    <h3 style="color: var(--accent); margin-bottom: 15px;">üí¨ –û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è</h3>
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages"></div>
                        <div class="chat-input-container">
                            <input type="text" id="chatInput" class="chat-input" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." maxlength="200">
                            <button class="btn" onclick="sendMessage()" style="padding: 15px 30px;">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ -->
            <div class="card">
                <h3 style="color: var(--primary); margin-bottom: 20px; text-align: center; font-size: 1.8rem;">–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–∂</h3>
                <div class="character-card" id="characterCard"></div>
            </div>

            <!-- –Ü–Ω—à—ñ –≥—Ä–∞–≤—Ü—ñ -->
            <div class="card">
                <h3 style="color: var(--primary); margin-bottom: 20px; text-align: center; font-size: 1.8rem;">–Ü–Ω—à—ñ –≥—Ä–∞–≤—Ü—ñ</h3>
                <div id="otherPlayersContainer"></div>
            </div>

            <!-- –ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è -->
            <div class="card" id="votingSection" style="display: none;">
                <h3 style="color: var(--danger); margin-bottom: 20px; text-align: center; font-size: 1.8rem;">–ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –∑–∞ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è</h3>
                <div class="status-message warning">–û–±–µ—Ä—ñ—Ç—å –≥—Ä–∞–≤—Ü—è, —è–∫–æ–≥–æ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–ª—é—á–∏—Ç–∏ –∑ –±—É–Ω–∫–µ—Ä—É</div>
                <div class="vote-container" id="voteContainer"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-danger" onclick="submitVote()" id="submitVoteBtn">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≥–æ–ª–æ—Å</button>
                </div>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è -->
            <div id="voteResultsContainer"></div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥—ñ–π -->
            <div class="action-buttons" id="gameActions"></div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –∫—ñ–Ω—Ü—è –≥—Ä–∏ -->
        <div id="endScreen" class="screen">
            <div class="card">
                <h2 style="text-align: center; font-size: 3rem; margin-bottom: 30px; color: var(--bunker-green);">–ì—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
                <div id="winnersContainer"></div>
                <div class="action-buttons">
                    <button class="btn" onclick="location.reload()">–ù–æ–≤–∞ –≥—Ä–∞</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay –¥–ª—è popup -->
    <div class="overlay" id="overlay"></div>

    <!-- Popup –¥–ª—è –ø–æ–¥—ñ–π -->
    <div class="event-popup" id="eventPopup">
        <div class="event-title" id="eventTitle"></div>
        <div class="event-description" id="eventDescription"></div>
        <div style="text-align: center;">
            <button class="btn" onclick="closeEvent()">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
        </div>
    </div>

    <!-- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—É –≤–µ—Ä—Å—ñ—é PartyKit –¥–ª—è –æ–Ω–ª–∞–π–Ω –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä—É -->
    <script type="module">
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
        window.gameState = {
            roomCode: '',
            playerId: null,
            players: [],
            currentPlayer: null,
            isHost: false,
            gameStarted: false,
            phase: 'lobby',
            scenario: null,
            bunkerCapacity: 0,
            currentVote: null,
            votingResults: {},
            timerStartTime: null,
            timerDuration: 300,
            discussionTime: 5,
            messages: [],
            finalStory: null
        };

        // AI –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
        window.aiConfig = {
            provider: localStorage.getItem('ai_provider') || 'none',
            apiKey: localStorage.getItem('ai_key') || ''
        };

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É AI –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('DOMContentLoaded', () => {
            updateAIStatusIndicator();
        });

        function updateAIStatusIndicator() {
            const indicator = document.getElementById('aiStatusIndicator');
            if (!indicator) return;
            
            if (window.aiConfig.provider === 'none' || !window.aiConfig.apiKey) {
                indicator.innerHTML = `
                    <div style="color: var(--accent); font-weight: 500;">‚ö†Ô∏è AI –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ</div>
                    <div style="color: var(--light); font-size: 0.9rem; margin-top: 5px;">–ë–µ–∑ AI –∫–ª—é—á–∞ - –±–∞–∑–æ–≤—ñ —Ç–µ–∫—Å—Ç–∏ –∑–∞–º—ñ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó</div>
                `;
                indicator.style.background = 'rgba(255, 210, 63, 0.2)';
                indicator.style.borderColor = 'var(--accent)';
            } else {
                const providerNames = {
                    'gemini': 'ü§ñ Google Gemini',
                    'openai': 'ü§ñ OpenAI ChatGPT'
                };
                indicator.innerHTML = `
                    <div style="color: var(--bunker-green); font-weight: 500;">‚úÖ AI –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ: ${providerNames[window.aiConfig.provider]}</div>
                    <div style="color: var(--light); font-size: 0.9rem; margin-top: 5px;">–£–Ω—ñ–∫–∞–ª—å–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –±—É–¥—É—Ç—å –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</div>
                `;
                indicator.style.background = 'rgba(59, 186, 92, 0.2)';
                indicator.style.borderColor = 'var(--bunker-green)';
            }
        }

        window.showAISettings = function() {
            showScreen('aiSettingsScreen');
            document.getElementById('aiProviderSelect').value = window.aiConfig.provider;
            updateAIProvider();
        }

        window.updateAIProvider = function() {
            const provider = document.getElementById('aiProviderSelect').value;
            const keySection = document.getElementById('aiKeySection');
            const instructions = document.getElementById('aiInstructions');
            
            if (provider === 'none') {
                keySection.style.display = 'none';
            } else {
                keySection.style.display = 'block';
                
                if (provider === 'gemini') {
                    instructions.innerHTML = `
                        <strong style="color: var(--bunker-green);">–Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π Gemini API –∫–ª—é—á:</strong><br><br>
                        1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: var(--primary);">Google AI Studio</a><br>
                        2. –ù–∞—Ç–∏—Å–Ω–∏ "Get API Key" ‚Üí "Create API Key"<br>
                        3. –û–±–µ—Ä–∏ –∞–±–æ —Å—Ç–≤–æ—Ä–∏ Google Cloud –ø—Ä–æ–µ–∫—Ç<br>
                        4. –°–∫–æ–ø—ñ—é–π –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–ª—é—á (–ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ "AIza...")<br>
                        5. –í–∫–ª–µ–π –π–æ–≥–æ —Ç—É—Ç<br><br>
                        <strong style="color: var(--accent);">üí° –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ:</strong> 15 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ —Ö–≤–∏–ª–∏–Ω—É, 1500 –Ω–∞ –¥–µ–Ω—å
                    `;
                } else if (provider === 'openai') {
                    instructions.innerHTML = `
                        <strong style="color: var(--bunker-green);">–Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ OpenAI API –∫–ª—é—á:</strong><br><br>
                        1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ <a href="https://platform.openai.com/api-keys" target="_blank" style="color: var(--primary);">OpenAI Platform</a><br>
                        2. –ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Å—è –∞–±–æ —É–≤—ñ–π–¥–∏<br>
                        3. –ù–∞—Ç–∏—Å–Ω–∏ "Create new secret key"<br>
                        4. –°–∫–æ–ø—ñ—é–π –∫–ª—é—á (–ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ "sk-...")<br>
                        5. –í–∫–ª–µ–π –π–æ–≥–æ —Ç—É—Ç<br><br>
                        <strong style="color: var(--accent);">üí∞ –ü–ª–∞—Ç–Ω–æ:</strong> $5 –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ –ø—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó, –ø–æ—Ç—ñ–º $0.002 –∑–∞ –∑–∞–ø–∏—Ç
                    `;
                }
            }
        }

        window.saveAISettings = function() {
            const provider = document.getElementById('aiProviderSelect').value;
            const apiKey = document.getElementById('aiKeyInput').value.trim();
            
            if (provider !== 'none' && !apiKey) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å API –∫–ª—é—á –∞–±–æ –æ–±–µ—Ä—ñ—Ç—å "–ë–µ–∑ AI"');
                return;
            }
            
            window.aiConfig.provider = provider;
            window.aiConfig.apiKey = apiKey;
            
            localStorage.setItem('ai_provider', provider);
            localStorage.setItem('ai_key', apiKey);
            
            updateAIStatusIndicator();
            alert('–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
            showMenu();
        }

        // –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
        const characterDatabase = {
            professions: [
                '–õ—ñ–∫–∞—Ä-—Ö—ñ—Ä—É—Ä–≥', '–í—á–∏—Ç–µ–ª—å', '–Ü–Ω–∂–µ–Ω–µ—Ä', '–ü—Ä–æ–≥—Ä–∞–º—ñ—Å—Ç', '–ï–ª–µ–∫—Ç—Ä–∏–∫', '–°–∞–Ω—Ç–µ—Ö–Ω—ñ–∫', 
                '–ö—É—Ö–∞—Ä', '–§–µ—Ä–º–µ—Ä', '–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä', '–ü—Å–∏—Ö–æ–ª–æ–≥', '–ú–µ—Ö–∞–Ω—ñ–∫', '–ë—É–¥—ñ–≤–µ–ª—å–Ω–∏–∫',
                '–ü–æ–∂–µ–∂–Ω–∏–∫', '–ü–æ–ª—ñ—Ü–µ–π—Å—å–∫–∏–π', '–í—ñ–π—Å—å–∫–æ–≤–∏–π', '–ü—ñ–ª–æ—Ç', '–ú–æ—Ä—è–∫', '–í–æ–¥—ñ–π',
                '–í—á–µ–Ω–∏–π-–±—ñ–æ–ª–æ–≥', '–•—ñ–º—ñ–∫', '–§—ñ–∑–∏–∫', '–ú–∞—Ç–µ–º–∞—Ç–∏–∫', '–ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä', '–î–∏–∑–∞–π–Ω–µ—Ä',
                '–ñ—É—Ä–Ω–∞–ª—ñ—Å—Ç', '–Æ—Ä–∏—Å—Ç', '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä', '–ú—É–∑–∏–∫–∞–Ω—Ç', '–•—É–¥–æ–∂–Ω–∏–∫', '–ê–∫—Ç–æ—Ä',
                '–°–ø–æ—Ä—Ç—Å–º–µ–Ω', '–¢—Ä–µ–Ω–µ—Ä', '–ú–∞—Å–∞–∂–∏—Å—Ç', '–ü–µ—Ä—É–∫–∞—Ä', '–§–æ—Ç–æ–≥—Ä–∞—Ñ', '–í—ñ–¥–µ–æ–æ–ø–µ—Ä–∞—Ç–æ—Ä',
                '–ï–ª–µ–∫—Ç—Ä–æ–Ω—ñ–∫', '–†–∞–¥—ñ–æ—Ç–µ—Ö–Ω—ñ–∫', '–ê–≥—Ä–æ–Ω–æ–º', '–ó–æ–æ–ª–æ–≥', '–ì–µ–æ–≥—Ä–∞—Ñ', '–Ü—Å—Ç–æ—Ä–∏–∫',
                '–§—ñ–ª–æ—Å–æ—Ñ', '–°–æ—Ü—ñ–æ–ª–æ–≥', '–ï–∫–æ–Ω–æ–º—ñ—Å—Ç', '–ü–æ–ª—ñ—Ç–æ–ª–æ–≥', '–ê—Å—Ç—Ä–æ–Ω–æ–º', '–ì–µ–æ–ª–æ–≥',
                '–ú–∏—Å–ª–∏–≤–µ—Ü—å', '–†–∏–±–∞–ª–∫–∞', '–ü–∞—Å—ñ—á–Ω–∏–∫', '–°–∞–¥—ñ–≤–Ω–∏–∫', '–§–ª–æ—Ä–∏—Å—Ç', '–ë–∞—Ä–º–µ–Ω',
                '–û—Ñ—ñ—Ü—ñ–∞–Ω—Ç', '–ü—Ä–∏–±–∏—Ä–∞–ª—å–Ω–∏–∫', '–û—Ö–æ—Ä–æ–Ω–µ—Ü—å', '–ï–∫—Å–∫—É—Ä—Å–æ–≤–æ–¥', '–ü–µ—Ä–µ–∫–ª–∞–¥–∞—á', '–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ä'
            ],
            
            health: [
                '–í—ñ–¥–º—ñ–Ω–Ω–µ –∑–¥–æ—Ä–æ–≤\'—è', '–•–æ—Ä–æ—à–µ –∑–¥–æ—Ä–æ–≤\'—è', '–ó–∞–¥–æ–≤—ñ–ª—å–Ω–µ –∑–¥–æ—Ä–æ–≤\'—è', 
                '–î—ñ–∞–±–µ—Ç (–ø—ñ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º)', '–ê—Å—Ç–º–∞ (–ª–µ–≥–∫–∞ —Ñ–æ—Ä–º–∞)', '–ê–ª–µ—Ä–≥—ñ—è –Ω–∞ –ø–∏–ª–æ–∫',
                '–ö–æ—Ä–æ—Ç–∫–æ–∑–æ—Ä—ñ—Å—Ç—å', '–î–∞–ª–µ–∫–æ–∑–æ—Ä—ñ—Å—Ç—å', '–ü–æ—Ä—É—à–µ–Ω–Ω—è —Å–ª—É—Ö—É (–ª–µ–≥–∫–µ)', 
                '–ê—Ä—Ç—Ä–∏—Ç (–ø–æ—á–∞—Ç–∫–æ–≤–∞ —Å—Ç–∞–¥—ñ—è)', '–ú—ñ–≥—Ä–µ–Ω—å (–µ–ø—ñ–∑–æ–¥–∏—á–Ω–∞)', '–ì—ñ–ø–µ—Ä—Ç–æ–Ω—ñ—è (–∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∞)',
                '–ì–∞—Å—Ç—Ä–∏—Ç', '–í–∞—Ä–∏–∫–æ–∑', '–û—Å—Ç–µ–æ—Ö–æ–Ω–¥—Ä–æ–∑', '–î–µ—Ä–º–∞—Ç–∏—Ç',
                '–í–Ü–õ-–ø–æ–∑–∏—Ç–∏–≤–Ω–∏–π (–Ω–∞ —Ç–µ—Ä–∞–ø—ñ—ó)', '–ì–µ–ø–∞—Ç–∏—Ç C (–≤–∏–ª—ñ–∫—É–≤–∞–Ω–∏–π)', '–í—Ç—Ä–∞—Ç–∞ –∫—ñ–Ω—Ü—ñ–≤–∫–∏ (–ø—Ä–æ—Ç–µ–∑)',
                '–ü–∞—Ä–∞–ª—ñ—á –æ–¥–Ω—ñ—î—ó —Ä—É–∫–∏', '–•—Ä–æ–Ω—ñ—á–Ω–∞ –≤—Ç–æ–º–∞', '–ë–µ–∑—Å–æ–Ω–Ω—è', '–ï–ø—ñ–ª–µ–ø—Å—ñ—è (—Ä—ñ–¥–∫—ñ—Å–Ω—ñ –Ω–∞–ø–∞–¥–∏)',
                '–ê–Ω–µ–º—ñ—è', '–°–∫–æ–ª—ñ–æ–∑', '–ü–ª–æ—Å–∫–æ—Å—Ç–æ–ø—ñ—Å—Ç—å'
            ],
            
            hobbies: [
                '–ü–æ–ª—é–≤–∞–Ω–Ω—è', '–†–∏–±–æ–ª–æ–≤–ª—è', '–°–∞–¥—ñ–≤–Ω–∏—Ü—Ç–≤–æ', '–ö—É–ª—ñ–Ω–∞—Ä—ñ—è', '–†—É–∫–æ–¥—ñ–ª–ª—è', '–í\'—è–∑–∞–Ω–Ω—è',
                '–°—Ç–æ–ª—è—Ä—Å—Ç–≤–æ', '–ú–µ—Ç–∞–ª–æ–æ–±—Ä–æ–±–∫–∞', '–ú–∞–ª—é–≤–∞–Ω–Ω—è', '–ú—É–∑–∏–∫–∞', '–°–ø—ñ–≤–∏', '–¢–∞–Ω—Ü—ñ',
                '–ô–æ–≥–∞', '–ú–µ–¥–∏—Ç–∞—Ü—ñ—è', '–ë—ñ–≥', '–ü–ª–∞–≤–∞–Ω–Ω—è', '–ë–æ–∫—Å', '–Ñ–¥–∏–Ω–æ–±–æ—Ä—Å—Ç–≤–∞',
                '–®–∞—Ö–∏', '–ü–æ–∫–µ—Ä', '–ù–∞—Å—Ç—ñ–ª—å–Ω—ñ —ñ–≥—Ä–∏', '–í—ñ–¥–µ–æ—ñ–≥—Ä–∏', '–ß–∏—Ç–∞–Ω–Ω—è', '–ü–∏—Å—å–º–µ–Ω–Ω–∏—Ü—Ç–≤–æ',
                '–§–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—è', '–í—ñ–¥–µ–æ–º–æ–Ω—Ç–∞–∂', '–ü—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è', '–ï–ª–µ–∫—Ç—Ä–æ–Ω—ñ–∫–∞', '–†–∞–¥—ñ–æ–∑–≤\'—è–∑–æ–∫', '–ê—Å—Ç—Ä–æ–Ω–æ–º—ñ—è',
                '–ì–µ–æ–ª–æ–≥—ñ—è', '–ë–æ—Ç–∞–Ω—ñ–∫–∞', '–û—Ä–Ω—ñ—Ç–æ–ª–æ–≥—ñ—è', '–ê–∫–≤–∞—Ä—ñ—É–º—ñ—Å—Ç–∏–∫–∞', '–¢–µ—Ä–∞—Ä—ñ—É–º—ñ—Å—Ç–∏–∫–∞', '–ë–¥–∂—ñ–ª—å–Ω–∏—Ü—Ç–≤–æ',
                '–í–∏–Ω–æ—Ä–æ–±—Å—Ç–≤–æ', '–°–∏—Ä–æ–≤–∞—Ä—ñ–Ω–Ω—è', '–•–ª—ñ–±–æ–ø–µ—á–µ–Ω–Ω—è', '–ö–æ–Ω—Å–µ—Ä–≤—É–≤–∞–Ω–Ω—è', '–í–∏–∂–∏–≤–∞–Ω–Ω—è –≤ –¥–∏–∫—ñ–π –ø—Ä–∏—Ä–æ–¥—ñ', '–°–∫–µ–ª–µ–ª–∞–∑—ñ–Ω–Ω—è',
                '–ü–∞—Ä–∞—à—É—Ç–Ω–∏–π —Å–ø–æ—Ä—Ç', '–î–∞–π–≤—ñ–Ω–≥', '–°–µ—Ä—Ñ—ñ–Ω–≥', '–í–µ–ª–æ—Å–ø–æ—Ä—Ç', '–ú–æ—Ç–æ—Å–ø–æ—Ä—Ç', '–ê–≤—Ç–æ—Å–ø–æ—Ä—Ç'
            ],
            
            baggage: [
                '–ù—ñ–∂-–º—É–ª—å—Ç–∏—Ç—É–ª', '–ê–ø—Ç–µ—á–∫–∞ –ø–µ—Ä—à–æ—ó –¥–æ–ø–æ–º–æ–≥–∏', '–ó–∞–ø–∞–ª—å–Ω–∏—á–∫–∞ Zippo', '–õ—ñ—Ö—Ç–∞—Ä–∏–∫ –∑ –¥–∏–Ω–∞–º–æ',
                '–ú–æ—Ç—É–∑–∫–∞ (20–º)', '–ö–æ–º–ø–∞—Å', '–ö–∞—Ä—Ç–∞ –º—ñ—Å—Ü–µ–≤–æ—Å—Ç—ñ', '–†–∞–¥—ñ–æ–ø—Ä–∏–π–º–∞—á', '–†–∞—Ü—ñ—è',
                '–¢–µ—Ä–º–æ—Å –∑ –≤–æ–¥–æ—é', '–°—É—Ö–ø–∞–π–æ–∫ (3 –¥–Ω—ñ)', '–ö–æ–Ω—Å–µ—Ä–≤–∏ (10 –±–∞–Ω–æ–∫)', '–ù–∞—Å—ñ–Ω–Ω—è –æ–≤–æ—á—ñ–≤',
                '–ö–Ω–∏–≥–∞ –∑ –≤–∏–∂–∏–≤–∞–Ω–Ω—è', '–ê—Ç–ª–∞—Å –ª—ñ–∫–∞—Ä—Å—å–∫–∏—Ö —Ä–æ—Å–ª–∏–Ω', '–ï–Ω—Ü–∏–∫–ª–æ–ø–µ–¥—ñ—è', '–ë—ñ–±–ª—ñ—è',
                '–ì—ñ—Ç–∞—Ä–∞', '–ì—É–±–Ω–∞ –≥–∞—Ä–º–æ—à–∫–∞', '–©–æ–¥–µ–Ω–Ω–∏–∫', '–†—É—á–∫–∞ —Ç–∞ –±–ª–æ–∫–Ω–æ—Ç',
                '–¢–µ–ø–ª–∏–π —Å–ø–∞–ª—å–Ω–∏–π –º—ñ—à–æ–∫', '–ü–∞–ª–∞—Ç–∫–∞', '–ö–æ—Ç–µ–ª–æ–∫', '–ü–æ—Å—É–¥', '–ú–∏–ª–æ —Ç–∞ —à–∞–º–ø—É–Ω—å',
                '–ó—É–±–Ω–∞ —â—ñ—Ç–∫–∞ —ñ –ø–∞—Å—Ç–∞', '–ü–æ–ª–æ—Ç–µ–Ω—Ü–µ', '–û–¥—è–≥ (–∫–æ–º–ø–ª–µ–∫—Ç)', '–í–∑—É—Ç—Ç—è (2 –ø–∞—Ä–∏)', '–î–æ—â–æ–≤–∏–∫',
                '–°–æ–Ω—è—á–Ω—ñ –æ–∫—É–ª—è—Ä–∏', '–ü–∞–Ω–∞–º–∞', '–†—É–∫–∞–≤–∏—á–∫–∏', '–®–∞—Ä—Ñ', '–†—é–∫–∑–∞–∫',
                '–°–æ–∫–∏—Ä–∞', '–õ–æ–ø–∞—Ç–∞', '–ü–∏–ª–∞', '–ú–æ–ª–æ—Ç–æ–∫', '–¶–≤—è—Ö–∏ —Ç–∞ —à—É—Ä—É–ø–∏',
                '–†–∏–±–æ–ª–æ–≤–Ω–µ –∑–Ω–∞—Ä—è–¥–¥—è', '–õ—É–∫ –∑—ñ —Å—Ç—Ä—ñ–ª–∞–º–∏', '–ü—Ä–∞—â–∞', '–ù–æ—É—Ç–±—É–∫', '–ü–ª–∞–Ω—à–µ—Ç',
                '–°–æ–Ω—è—á–Ω–∞ –±–∞—Ç–∞—Ä–µ—è', '–ü–∞—É–µ—Ä–±–∞–Ω–∫', 'USB-—Ñ–ª–µ—à–∫–∞ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é', '–§–æ—Ç–æ–∞–ø–∞—Ä–∞—Ç', '–ë—ñ–Ω–æ–∫–ª—å',
                '–®–∞—Ö–∏', '–ö–∞—Ä—Ç–∏', '–ú\'—è—á', '–ì—ñ—Ç–∞—Ä–Ω—ñ —Å—Ç—Ä—É–Ω–∏ (–∑–∞–ø–∞—Å–Ω—ñ)', '–ë–∞—Ç–∞—Ä–µ–π–∫–∏ (–Ω–∞–±—ñ—Ä)'
            ],
            
            phobias: [
                '–ö–ª–∞—É—Å—Ç—Ä–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –∑–∞–º–∫–Ω—É—Ç–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É)', '–ê–≥–æ—Ä–∞—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –≤—ñ–¥–∫—Ä–∏—Ç–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É)', 
                '–ê–∫—Ä–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –≤–∏—Å–æ—Ç–∏)', '–ê—Ä–∞—Ö–Ω–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –ø–∞–≤—É–∫—ñ–≤)', '–û—Ñ—ñ–¥—ñ–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –∑–º—ñ–π)',
                '–ö—ñ–Ω–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å —Å–æ–±–∞–∫)', '–ê–π–ª—É—Ä–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –∫–æ—Ç—ñ–≤)', '–ï–Ω—Ç–æ–º–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –∫–æ–º–∞—Ö)',
                '–ê–∫–≤–∞—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –≤–æ–¥–∏)', '–ü—ñ—Ä–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –≤–æ–≥–Ω—é)', '–ì–µ–º–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –∫—Ä–æ–≤—ñ)',
                '–¢—Ä–∏–ø–∞–Ω–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –≥–æ–ª–æ–∫)', '–ù—ñ–∫—Ç–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å —Ç–µ–º—Ä—è–≤–∏)', '–ê—Å—Ç—Ä–∞–ø–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –≥—Ä–æ–∑–∏)',
                '–°–æ—Ü—ñ–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –ª—é–¥–µ–π)', '–¢–∞–Ω–∞—Ç–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å —Å–º–µ—Ä—Ç—ñ)', '–ù–µ–∫—Ä–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å —Ç—Ä—É–ø—ñ–≤)',
                '–ú—ñ–∫—Ä–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –º—ñ–∫—Ä–æ–±—ñ–≤)', '–¢—Ä–∏—Å–∫–∞—ñ–¥–µ–∫–∞—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å —á–∏—Å–ª–∞ 13)', '–ú–µ—Ç–∞—Ç–µ–∑—ñ–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –∑–º—ñ–Ω)',
                '–ú–æ–Ω–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å —Å–∞–º–æ—Ç–Ω–æ—Å—Ç—ñ)', '–§–æ–Ω–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –≥—É—á–Ω–∏—Ö –∑–≤—É–∫—ñ–≤)', '–•—Ä–æ–Ω–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å —á–∞—Å—É)',
                '–ì–ª–æ—Å–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –≤–∏—Å—Ç—É–ø—ñ–≤)', '–§—ñ–ª–µ–º–∞—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å –ø–æ—Ü—ñ–ª—É–Ω–∫—ñ–≤)', '–û–¥–æ–Ω—Ç–æ—Ñ–æ–±—ñ—è (–±–æ—è–∑–Ω—å —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥—ñ–≤)'
            ],
            
            traits: [
                '–û–ø—Ç–∏–º—ñ—Å—Ç', '–ü–µ—Å–∏–º—ñ—Å—Ç', '–†–µ–∞–ª—ñ—Å—Ç', '–õ—ñ–¥–µ—Ä', '–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å', '–ö—Ä–µ–∞—Ç–∏–≤–Ω–∏–π –º–∏—Å–ª–∏—Ç–µ–ª—å',
                '–ê–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏–π —Ä–æ–∑—É–º', '–ï–º–ø–∞—Ç', '–Ü–Ω—Ç—Ä–æ–≤–µ—Ä—Ç', '–ï–∫—Å—Ç—Ä–∞–≤–µ—Ä—Ç', '–ê–º–±—ñ–≤–µ—Ä—Ç', '–ü–µ—Ä—Ñ–µ–∫—Ü—ñ–æ–Ω—ñ—Å—Ç',
                '–ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä', '–¢—Ä—É–¥–æ–≥–æ–ª—ñ–∫', '–ê–≤–∞–Ω—Ç—é—Ä–∏—Å—Ç', '–û–±–µ—Ä–µ–∂–Ω–∏–π', '–Ü–º–ø—É–ª—å—Å–∏–≤–Ω–∏–π', '–†–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π',
                '–†–æ–º–∞–Ω—Ç–∏–∫', '–ü—Ä–∞–≥–º–∞—Ç–∏–∫', '–ê–ª—å—Ç—Ä—É—ó—Å—Ç', '–ï–≥–æ—ó—Å—Ç', '–ß–µ—Å–Ω–∏–π', '–ë—Ä–µ—Ö–ª–∏–≤–∏–π',
                '–í—ñ—Ä–Ω–∏–π', '–ó—Ä–∞–¥–Ω–∏–∫', '–©–µ–¥—Ä–∏–π', '–°–∫—É–ø–∏–π', '–•—Ä–∞–±—Ä–∏–π', '–ë–æ—è–≥—É–∑–ª–∏–≤–∏–π',
                '–¢–µ—Ä–ø–ª—è—á–∏–π', '–ù–µ—Ç–µ—Ä–ø–ª—è—á–∏–π', '–î–∏—Å—Ü–∏–ø–ª—ñ–Ω–æ–≤–∞–Ω–∏–π', '–•–∞–æ—Ç–∏—á–Ω–∏–π', '–û—Ä–≥–∞–Ω—ñ–∑–æ–≤–∞–Ω–∏–π', '–ù–µ–æ—Ä–≥–∞–Ω—ñ–∑–æ–≤–∞–Ω–∏–π',
                '–ê–º–±—ñ—Ç–Ω–∏–π', '–°–∫—Ä–æ–º–Ω–∏–π', '–ö–æ–Ω—Ñ–ª—ñ–∫—Ç–Ω–∏–π', '–ú–∏—Ä–æ—Ç–≤–æ—Ä–µ—Ü—å', '–ì—É–º–æ—Ä–∏—Å—Ç–∏—á–Ω–∏–π', '–°–µ—Ä–π–æ–∑–Ω–∏–π',
                '–î–æ–≤—ñ—Ä–ª–∏–≤–∏–π', '–ü—ñ–¥–æ–∑—Ä—ñ–ª–∏–π', '–°–ø–æ–Ω—Ç–∞–Ω–Ω–∏–π', '–ü–ª–∞–Ω—É—é—á–∏–π', '–ï–Ω–µ—Ä–≥—ñ–π–Ω–∏–π', '–°–ø–æ–∫—ñ–π–Ω–∏–π'
            ],
            
            additional: [
                '–ú–∞—î –¥–æ—Å–≤—ñ–¥ –≤–∏–∂–∏–≤–∞–Ω–Ω—è –≤ –¥–∏–∫—ñ–π –ø—Ä–∏—Ä–æ–¥—ñ', '–ö–æ–ª–∏—à–Ω—ñ–π –≤—ñ–π—Å—å–∫–æ–≤–∏–π', '–ú–∞–π—Å—Ç–µ—Ä —Å–ø–æ—Ä—Ç—É',
                '–ú–∞—î –¥–≤–æ—Ö –¥—ñ—Ç–µ–π', '–ú–∞—î –æ–¥–Ω—É –¥–∏—Ç–∏–Ω—É', '–í–∞–≥—ñ—Ç–Ω–∞ (3 –º—ñ—Å—è—Ü—ñ)', '–í–∞–≥—ñ—Ç–Ω–∞ (7 –º—ñ—Å—è—Ü—ñ–≤)',
                '–û–¥—Ä—É–∂–µ–Ω–∏–π/–∑–∞–º—ñ–∂–Ω—è', '–†–æ–∑–ª—É—á–µ–Ω–∏–π/—Ä–æ–∑–ª—É—á–µ–Ω–∞', '–£–¥—ñ–≤–µ—Ü—å/—É–¥–æ–≤–∞', '–•–æ–ª–æ—Å—Ç–∏–π/–Ω–µ–æ–¥—Ä—É–∂–µ–Ω–∞',
                '–ú–∞—î –ª—ñ—Ç–Ω—ñ–π –¥–æ—Å–≤—ñ–¥', '–í–ª–∞—Å–Ω–∏–∫ —Å–æ–±–∞–∫–∏-–ø–æ–≤–æ–¥–∏—Ä—è', '–ó–Ω–∞—î 5 –º–æ–≤', '–ó–Ω–∞—î 3 –º–æ–≤–∏',
                '–ú–∞—î –≤–æ–¥—ñ–π—Å—å–∫—ñ –ø—Ä–∞–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó A, B, C', '–ú–∞—î –≤–∞–Ω—Ç–∞–∂—ñ–≤–∫—É', '–ú–∞—î —á–æ–≤–µ–Ω',
                '–ú–∞—î —Ä–∞–¥—ñ–æ—Å—Ç–∞–Ω—Ü—ñ—é', '–ú–∞—î –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä', '–ú–∞—î —Å–æ–Ω—è—á–Ω—ñ –ø–∞–Ω–µ–ª—ñ', '–ú–∞—î –∑–∞–ø–∞—Å–∏ —ó–∂—ñ (—Ä—ñ–∫)',
                '–ó–Ω–∞—î –º—ñ—Å—Ü–µ —Å—Ö–æ–≤–∞–Ω–∫–∏ –∑–±—Ä–æ—ó', '–ú–∞—î –∫–∞—Ä—Ç—É –ø—ñ–¥–∑–µ–º–Ω–∏—Ö —Ç—É–Ω–µ–ª—ñ–≤', '–ó–Ω–∞—î —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –±—É–Ω–∫–µ—Ä',
                '–ú–∞—î –º–µ–¥–∏—á–Ω—É –æ—Å–≤—ñ—Ç—É', '–ú–∞—î –ø–µ–¥–∞–≥–æ–≥—ñ—á–Ω—É –æ—Å–≤—ñ—Ç—É', '–ú–∞—î —Ç–µ—Ö–Ω—ñ—á–Ω—É –æ—Å–≤—ñ—Ç—É', '–ú–∞—î –≥—É–º–∞–Ω—ñ—Ç–∞—Ä–Ω—É –æ—Å–≤—ñ—Ç—É',
                '–°–∞–º–æ—É—á–∫–∞ –≤ –±–∞–≥–∞—Ç—å–æ—Ö —Å—Ñ–µ—Ä–∞—Ö', '–ú–∞—î –≤–µ–ª–∏–∫–∏–π –±–æ—Ä–≥', '–ë–∞–≥–∞—Ç–∏–π/–±–∞–≥–∞—Ç–∞', '–°–µ—Ä–µ–¥–Ω—ñ–π –¥–æ—Å—Ç–∞—Ç–æ–∫',
                '–ë—ñ–¥–Ω–∏–π/–±—ñ–¥–Ω–∞', '–í–µ–≥–∞–Ω', '–í–µ–≥–µ—Ç–∞—Ä—ñ–∞–Ω–µ—Ü—å', '–ú\'—è—Å–æ—ó–¥', '–ê–ª–∫–æ–≥–æ–ª—ñ–∫ (—É —Ä–µ–º—ñ—Å—ñ—ó)',
                '–ö—É—Ä–µ—Ü—å', '–ù–µ –ø\'—î —ñ –Ω–µ –∫—É—Ä–∏—Ç—å', '–°–ø–æ—Ä—Ç–∏–≤–Ω–∞ —Ñ–æ—Ä–º–∞', '–ó–∞–π–≤–∞ –≤–∞–≥–∞', '–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—è –≤–∞–≥–∞',
                '–¢–∞—Ç—É—é–≤–∞–Ω–Ω—è –Ω–∞ 70% —Ç—ñ–ª–∞', '–ú–∞—î —Å—É–¥–∏–º—ñ—Å—Ç—å (–∑–∞ –¥—Ä—ñ–±–Ω—É –∫—Ä–∞–¥—ñ–∂–∫—É)', '–Ü–¥–µ–∞–ª—å–Ω–æ —á–∏—Å—Ç–∞ —Ä–µ–ø—É—Ç–∞—Ü—ñ—è',
                '–ö–æ–ª–∏—à–Ω—ñ–π –ø–æ–ª—ñ—Ç–∏–∫', '–ö–æ–ª–∏—à–Ω—ñ–π –∑–ª–æ—á–∏–Ω–µ—Ü—å (–≤–∏–ø—Ä–∞–≤–∏–≤—Å—è)', '–†–µ–ª—ñ–≥—ñ–π–Ω–∏–π —Ñ–∞–Ω–∞—Ç–∏–∫', '–ê—Ç–µ—ó—Å—Ç',
                '–ú–∞—î —Ç–∞–ª–∞–Ω—Ç –¥–æ —ñ–º–ø—Ä–æ–≤—ñ–∑–∞—Ü—ñ—ó', '–ú–∞—î —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—á–Ω—É –ø–∞–º\'—è—Ç—å', 'IQ 140+', 'IQ 90'
            ]
        };

        // –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤
        const scenarios = [
            {
                name: '–Ø–¥–µ—Ä–Ω–∞ –≤—ñ–π–Ω–∞',
                description: '–ü–æ—á–∞–ª–∞—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∞ —è–¥–µ—Ä–Ω–∞ –≤—ñ–π–Ω–∞. –†–∞–¥—ñ–∞—Ü—ñ—è –ø–æ–∫—Ä–∏—î –ø–ª–∞–Ω–µ—Ç—É –Ω–∞ 100 —Ä–æ–∫—ñ–≤. –ù–µ–æ–±—Ö—ñ–¥–Ω–æ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ —Ü–∏–≤—ñ–ª—ñ–∑–∞—Ü—ñ—é.',
                duration: '100 —Ä–æ–∫—ñ–≤',
                threat: '–†–∞–¥—ñ–∞—Ü—ñ—è, —è–¥–µ—Ä–Ω–∞ –∑–∏–º–∞'
            },
            {
                name: '–ó–æ–º–±—ñ-–∞–ø–æ–∫–∞–ª—ñ–ø—Å–∏—Å',
                description: '–ù–µ–≤—ñ–¥–æ–º–∏–π –≤—ñ—Ä—É—Å –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –ª—é–¥–µ–π –Ω–∞ –∑–æ–º–±—ñ. 95% –Ω–∞—Å–µ–ª–µ–Ω–Ω—è —ñ–Ω—Ñ—ñ–∫–æ–≤–∞–Ω–æ. –ü–æ—Ç—Ä—ñ–±–µ–Ω —á–∞—Å –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–∞–∫—Ü–∏–Ω–∏.',
                duration: '5 —Ä–æ–∫—ñ–≤',
                threat: '–ó–æ–º–±—ñ, –≥–æ–ª–æ–¥, —Ö–≤–æ—Ä–æ–±–∏'
            },
            {
                name: '–ê—Å—Ç–µ—Ä–æ—ó–¥',
                description: '–í–µ–ª–∏—á–µ–∑–Ω–∏–π –∞—Å—Ç–µ—Ä–æ—ó–¥ –≤—Ä—ñ–∑–∞–≤—Å—è –≤ –ó–µ–º–ª—é, –≤–∏–∫–ª–∏–∫–∞–≤—à–∏ —Ü—É–Ω–∞–º—ñ —Ç–∞ –≤–∏–≤–µ—Ä–∂–µ–Ω–Ω—è –≤—É–ª–∫–∞–Ω—ñ–≤. –ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ –∑–∞—Ç—å–º–∞—Ä–µ–Ω–∞.',
                duration: '50 —Ä–æ–∫—ñ–≤',
                threat: '–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Å–æ–Ω—Ü—è, —Ö–æ–ª–æ–¥, –≥–æ–ª–æ–¥'
            },
            {
                name: '–ü–∞–Ω–¥–µ–º—ñ—è',
                description: '–°–º–µ—Ä—Ç–µ–ª—å–Ω–∏–π –≤—ñ—Ä—É—Å –∑–Ω–∏—â–∏–≤ 80% –Ω–∞—Å–µ–ª–µ–Ω–Ω—è –ø–ª–∞–Ω–µ—Ç–∏. –Ü–º—É–Ω—ñ—Ç–µ—Ç –º–∞—é—Ç—å –ª–∏—à–µ –¥–µ—è–∫—ñ –ª—é–¥–∏.',
                duration: '10 —Ä–æ–∫—ñ–≤',
                threat: '–•–≤–æ—Ä–æ–±–∞, –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ñ–≤'
            },
            {
                name: '–Ü–Ω–æ–ø–ª–∞–Ω–µ—Ç–Ω–µ –≤—Ç–æ—Ä–≥–Ω–µ–Ω–Ω—è',
                description: '–ü—Ä–∏–±—É–ª—å—Ü—ñ –∞—Ç–∞–∫—É–≤–∞–ª–∏ –ó–µ–º–ª—é —ñ –∑–Ω–∏—â—É—é—Ç—å –ª—é–¥—Å—Ç–≤–æ. –í–æ–Ω–∏ —à—É–∫–∞—é—Ç—å –≤–∏–∂–∏–≤—à–∏—Ö —á–µ—Ä–µ–∑ —Å–∫–∞–Ω–µ—Ä–∏.',
                duration: '20 —Ä–æ–∫—ñ–≤',
                threat: '–ü—Ä–∏–±—É–ª—å—Ü—ñ, —Ä–æ–±–æ—Ç–∏, —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è'
            },
            {
                name: '–ì–ª–æ–±–∞–ª—å–Ω–µ –ø–æ—Ç–µ–ø–ª—ñ–Ω–Ω—è',
                description: '–õ—å–æ–¥–æ–≤–∏–∫–∏ —Ä–æ–∑—Ç–∞–Ω—É–ª–∏, —Ä—ñ–≤–µ–Ω—å –æ–∫–µ–∞–Ω—É –ø—ñ–¥–Ω—è–≤—Å—è –Ω–∞ 100 –º–µ—Ç—Ä—ñ–≤. –ë—ñ–ª—å—à—ñ—Å—Ç—å —Å—É—à—ñ –∑–∞—Ç–æ–ø–ª–µ–Ω–æ.',
                duration: '200 —Ä–æ–∫—ñ–≤',
                threat: '–ó–∞—Ç–æ–ø–ª–µ–Ω–Ω—è, —Å–ø–µ–∫–∞, –¥–µ—Ñ—ñ—Ü–∏—Ç –ø—Ä—ñ—Å–Ω–æ—ó –≤–æ–¥–∏'
            },
            {
                name: '–°–æ–Ω—è—á–Ω–∏–π —Å–ø–∞–ª–∞—Ö',
                description: '–ü–æ—Ç—É–∂–Ω–∏–π —Å–æ–Ω—è—á–Ω–∏–π —Å–ø–∞–ª–∞—Ö –∑–Ω–∏—â–∏–≤ –≤—Å—é –µ–ª–µ–∫—Ç—Ä–æ–Ω—ñ–∫—É –Ω–∞ –ø–ª–∞–Ω–µ—Ç—ñ. –ü–æ—á–∏–Ω–∞—î—Ç—å—Å—è –Ω–æ–≤–∏–π —Å–µ—Ä–µ–¥–Ω—å–æ–≤—ñ—á–Ω–∏–π –ø–µ—Ä—ñ–æ–¥.',
                duration: '30 —Ä–æ–∫—ñ–≤',
                threat: '–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –µ–ª–µ–∫—Ç—Ä–∏–∫–∏, –∞–Ω–∞—Ä—Ö—ñ—è'
            },
            {
                name: '–ë—ñ–æ–ª–æ–≥—ñ—á–Ω–∞ –∑–±—Ä–æ—è',
                description: '–í–∏–ø–∞–¥–∫–æ–≤–æ –≤–∏–ø—É—â–µ–Ω–∞ –±—ñ–æ–ª–æ–≥—ñ—á–Ω–∞ –∑–±—Ä–æ—è –∑–Ω–∏—â—É—î –≤—Å–µ –∂–∏–≤–µ –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω—ñ. –ü–æ–≤—ñ—Ç—Ä—è –æ—Ç—Ä—É–π–Ω–µ.',
                duration: '15 —Ä–æ–∫—ñ–≤',
                threat: '–û—Ç—Ä—É–π–Ω–µ –ø–æ–≤—ñ—Ç—Ä—è, –º—É—Ç–∞—Ü—ñ—ó'
            },
            {
                name: '–°—É–ø–µ—Ä–∑–≤—É–∫',
                description: '–î–∏–≤–Ω–∏–π –∑–≤—É–∫ –∑ –∫–æ—Å–º–æ—Å—É –∑–º—É—à—É—î –ª—é–¥–µ–π –±–æ–∂–µ–≤–æ–ª—ñ—Ç–∏ —Ç–∞ –≤–±–∏–≤–∞—Ç–∏ –æ–¥–∏–Ω –æ–¥–Ω–æ–≥–æ. –¢–∏—à–∞ - —î–¥–∏–Ω–∏–π –ø–æ—Ä—è—Ç—É–Ω–æ–∫.',
                duration: '3 —Ä–æ–∫–∏',
                threat: '–ó–≤—É–∫–æ–≤—ñ —Ö–≤–∏–ª—ñ, –±–æ–∂–µ–≤—ñ–ª–ª—è'
            },
            {
                name: '–ú–∞–≥–Ω—ñ—Ç–Ω–∞ –∞–Ω–æ–º–∞–ª—ñ—è',
                description: '–ú–∞–≥–Ω—ñ—Ç–Ω–µ –ø–æ–ª–µ –ó–µ–º–ª—ñ –∑–Ω–∏–∫–ª–æ. –°–æ–Ω—è—á–Ω–∞ —Ä–∞–¥—ñ–∞—Ü—ñ—è –≤–±–∏–≤–∞—î –≤—Å–µ –∂–∏–≤–µ –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω—ñ –∑–∞ –ª—ñ—á–µ–Ω—ñ —Ö–≤–∏–ª–∏–Ω–∏.',
                duration: '40 —Ä–æ–∫—ñ–≤',
                threat: '–ö–æ—Å–º—ñ—á–Ω–∞ —Ä–∞–¥—ñ–∞—Ü—ñ—è, –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó'
            }
        ];

        // –ü–æ–¥—ñ—ó –ø—ñ–¥ —á–∞—Å –≥—Ä–∏
        const gameEvents = [
            {
                title: '‚ö° –ó–ë–Ü–ô –ï–õ–ï–ö–¢–†–ò–ö–ò',
                description: '–í –±—É–Ω–∫–µ—Ä—ñ —Å—Ç–∞–≤—Å—è –∑–±—ñ–π —Å–∏—Å—Ç–µ–º–∏ –∂–∏—Ç—Ç—î–∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è. –•—Ç–æ—Å—å –º–∞—î —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ –≤—ñ–¥—Ä–µ–º–æ–Ω—Ç—É–≤–∞—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä, —ñ–Ω–∞–∫—à–µ –≤—Å—ñ –∑–∞–≥–∏–Ω—É—Ç—å!'
            },
            {
                title: 'üíä –ó–ù–ê–ô–î–ï–ù–û –õ–Ü–ö–ò',
                description: '–í–∏—è–≤–ª–µ–Ω–æ –Ω–µ–≤–µ–ª–∏–∫—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ª—ñ–∫—ñ–≤ —É —Å—Ö–æ–≤–∏—â—ñ. –í–æ–Ω–∏ –º–æ–∂—É—Ç—å –≤—Ä—è—Ç—É–≤–∞—Ç–∏ –∂–∏—Ç—Ç—è, –∞–ª–µ –∫–æ–º—É —ó—Ö –≤—ñ–¥–¥–∞—Ç–∏?'
            },
            {
                title: 'üî• –ü–û–ñ–ï–ñ–ê',
                description: '–£ –±—É–Ω–∫–µ—Ä—ñ –ø–æ—á–∞–ª–∞—Å—è –ø–æ–∂–µ–∂–∞! –ù–µ–æ–±—Ö—ñ–¥–Ω–æ —à–≤–∏–¥–∫–æ —ó—ó –∑–∞–≥–∞—Å–∏—Ç–∏, –¥–æ–∫–∏ –≤–æ–Ω–∞ –Ω–µ –∑–Ω–∏—â–∏–ª–∞ –∑–∞–ø–∞—Å–∏ —ó–∂—ñ.'
            },
            {
                title: 'üìª –†–ê–î–Ü–û–°–ò–ì–ù–ê–õ',
                description: '–í–ª–æ–≤–ª–µ–Ω–æ —Å–ª–∞–±–∫–∏–π —Ä–∞–¥—ñ–æ—Å–∏–≥–Ω–∞–ª –≤—ñ–¥ —ñ–Ω—à–∏—Ö –≤–∏–∂–∏–≤—à–∏—Ö. –ú–æ–∂–ª–∏–≤–æ, —î —â–µ –æ–¥–∏–Ω –±—É–Ω–∫–µ—Ä –Ω–µ–ø–æ–¥–∞–ª—ñ–∫.'
            },
            {
                title: 'ü¶† –•–í–û–†–û–ë–ê',
                description: '–•—Ç–æ—Å—å –∑–∞—Ö–≤–æ—Ä—ñ–≤ –Ω–µ–≤—ñ–¥–æ–º–æ—é —Ö–≤–æ—Ä–æ–±–æ—é. –¶–µ –º–æ–∂–µ –±—É—Ç–∏ –∑–∞—Ä–∞–∑–Ω–æ. –ö–∞—Ä–∞–Ω—Ç–∏–Ω –∞–±–æ –ª—ñ–∫—É–≤–∞–Ω–Ω—è?'
            },
            {
                title: 'üö™ –í–ò–¢–Ü–ö –ü–û–í–Ü–¢–†–Ø',
                description: '–í–∏—è–≤–ª–µ–Ω–æ —Ç—Ä—ñ—â–∏–Ω—É –≤ –≥–µ—Ä–º–µ—Ç–∏—á–Ω–∏—Ö –¥–≤–µ—Ä—è—Ö –±—É–Ω–∫–µ—Ä—É. –ü–æ–≤—ñ—Ç—Ä—è –≤–∏—Ç—ñ–∫–∞—î –Ω–∞–∑–æ–≤–Ω—ñ, –∞ —Ä–∞–¥—ñ–∞—Ü—ñ—è –ø—Ä–æ–Ω–∏–∫–∞—î –≤—Å–µ—Ä–µ–¥–∏–Ω—É!'
            },
            {
                title: 'üçû –î–ï–§–Ü–¶–ò–¢ –á–ñ–Ü',
                description: '–ó–∞–ø–∞—Å–∏ —ó–∂—ñ –∑–∞–∫—ñ–Ω—á—É—é—Ç—å—Å—è —à–≤–∏–¥—à–µ, –Ω—ñ–∂ –æ—á—ñ–∫—É–≤–∞–ª–æ—Å—è. –ü–æ—Ç—Ä—ñ–±–Ω–æ –∑–º–µ–Ω—à–∏—Ç–∏ –ø–∞–π–∫–∏ –∞–±–æ –∑–Ω–∞–π—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–∂–µ—Ä–µ–ª–∞.'
            },
            {
                title: 'üíé –¶–Ü–ù–ù–ê –ó–ù–ê–•–Ü–î–ö–ê',
                description: '–ó–Ω–∞–π–¥–µ–Ω–æ —Å—Ö–æ–≤–∞–Ω–∫—É –∑ –∫–æ—à—Ç–æ–≤–Ω–æ—Å—Ç—è–º–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –º–µ—à–∫–∞–Ω—Ü—ñ–≤. –¶–µ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç –∑–∞ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è.'
            },
            {
                title: 'üîä –î–ò–í–ù–Ü –ó–í–£–ö–ò',
                description: '–ó–æ–≤–Ω—ñ –±—É–Ω–∫–µ—Ä—É —á—É—Ç–∏ –¥–∏–≤–Ω—ñ –∑–≤—É–∫–∏. –•—Ç–æ—Å—å... –∞–±–æ —â–æ—Å—å... –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –ø—Ä–æ–Ω–∏–∫–Ω—É—Ç–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—É?'
            },
            {
                title: 'üìñ –ó–ù–ê–ô–î–ï–ù–û –ñ–£–†–ù–ê–õ',
                description: '–í–∏—è–≤–ª–µ–Ω–æ –∂—É—Ä–Ω–∞–ª –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –º–µ—à–∫–∞–Ω—Ü—ñ–≤ –±—É–Ω–∫–µ—Ä—É. –í –Ω—å–æ–º—É –æ–ø–∏—Å–∞–Ω—ñ –ø–æ–º–∏–ª–∫–∏, —è–∫—ñ –ø—Ä–∏–∑–≤–µ–ª–∏ –¥–æ —ó—Ö –∑–∞–≥–∏–±–µ–ª—ñ.'
            },
            {
                title: 'üå°Ô∏è –•–û–õ–û–î',
                description: '–°–∏—Å—Ç–µ–º–∞ –æ–ø–∞–ª–µ–Ω–Ω—è –¥–∞—î –∑–±—ñ–π. –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –±—É–Ω–∫–µ—Ä—ñ –ø–∞–¥–∞—î. –•—Ç–æ—Å—å –∑–∞–º–µ—Ä–∑–Ω–µ, —è–∫—â–æ –Ω–µ –≤–∂–∏—Ç–∏ –∑–∞—Ö–æ–¥—ñ–≤.'
            },
            {
                title: 'üîß –ü–û–õ–û–ú–ö–ê –§–Ü–õ–¨–¢–†–Ü–í',
                description: '–§—ñ–ª—å—Ç—Ä–∏ –æ—á–∏—â–µ–Ω–Ω—è –≤–æ–¥–∏ –≤–∏–π—à–ª–∏ –∑ –ª–∞–¥—É. –ë–µ–∑ –Ω–∏—Ö –≤–æ–¥–∞ —Å—Ç–∞—î –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ—é –¥–ª—è –≤–∂–∏–≤–∞–Ω–Ω—è.'
            }
        ];

        // –£—Ç–∏–ª—ñ—Ç–∏
        function generateRoomCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 4; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function randomElement(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function generateCharacter() {
            return {
                profession: randomElement(characterDatabase.professions),
                health: randomElement(characterDatabase.health),
                hobby: randomElement(characterDatabase.hobbies),
                baggage: randomElement(characterDatabase.baggage),
                phobia: randomElement(characterDatabase.phobias),
                trait: randomElement(characterDatabase.traits),
                additional: randomElement(characterDatabase.additional),
                age: Math.floor(Math.random() * 60) + 18,
                gender: Math.random() > 0.5 ? '–ß–æ–ª–æ–≤—ñ–∫' : '–ñ—ñ–Ω–∫–∞'
            };
        }

        // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ window.storage –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö (API Claude)
        async function saveRoomData() {
            try {
                const data = {
                    players: gameState.players,
                    scenario: gameState.scenario,
                    bunkerCapacity: gameState.bunkerCapacity,
                    gameStarted: gameState.gameStarted,
                    phase: gameState.phase,
                    timerStartTime: gameState.timerStartTime,
                    timerDuration: gameState.timerDuration,
                    discussionTime: gameState.discussionTime,
                    messages: gameState.messages,
                    votingResults: gameState.votingResults,
                    finalStory: gameState.finalStory
                };
                await window.storage.set(`room_${gameState.roomCode}`, JSON.stringify(data), true);
            } catch (e) {
                console.log('Storage not available, using localStorage fallback');
                localStorage.setItem(`bunker_${gameState.roomCode}`, JSON.stringify(gameState));
            }
        }

        async function loadRoomData(roomCode) {
            try {
                const result = await window.storage.get(`room_${roomCode}`, true);
                return result ? JSON.parse(result.value) : null;
            } catch (e) {
                console.log('Storage not available, using localStorage fallback');
                const data = localStorage.getItem(`bunker_${roomCode}`);
                return data ? JSON.parse(data) : null;
            }
        }

        // –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –º—ñ–∂ –µ–∫—Ä–∞–Ω–∞–º–∏
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        window.showMenu = function() {
            showScreen('menuScreen');
        }

        window.showCreateRoom = function() {
            showScreen('createRoomScreen');
        }

        window.showJoinRoom = function() {
            showScreen('joinRoomScreen');
        }

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—ñ–º–Ω–∞—Ç–∏
        window.createRoom = async function() {
            const hostName = document.getElementById('hostNameInput').value.trim();
            const maxPlayers = parseInt(document.getElementById('maxPlayersInput').value);
            const discussionTime = parseInt(document.getElementById('discussionTimeInput').value);
            
            if (!hostName) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º\'—è');
                return;
            }

            if (maxPlayers < 4 || maxPlayers > 8) {
                alert('–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≥—Ä–∞–≤—Ü—ñ–≤ –º–∞—î –±—É—Ç–∏ –≤—ñ–¥ 4 –¥–æ 8');
                return;
            }

            gameState.roomCode = generateRoomCode();
            gameState.playerId = Date.now().toString();
            gameState.isHost = true;
            gameState.discussionTime = discussionTime;
            
            gameState.currentPlayer = {
                id: gameState.playerId,
                name: hostName,
                character: generateCharacter(),
                isHost: true,
                eliminated: false
            };
            
            gameState.players = [gameState.currentPlayer];
            gameState.scenario = randomElement(scenarios);
            gameState.bunkerCapacity = Math.floor(maxPlayers / 2) + Math.floor(Math.random() * 2);
            
            await saveRoomData();
            updateLobby();
            showScreen('lobbyScreen');
            startPolling();
        }

        // –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –¥–æ –∫—ñ–º–Ω–∞—Ç–∏
        window.joinRoom = async function() {
            const playerName = document.getElementById('playerNameInput').value.trim();
            const roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
            
            if (!playerName || !roomCode) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è');
                return;
            }

            if (roomCode.length !== 4) {
                alert('–ö–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏ –º–∞—î —Å–∫–ª–∞–¥–∞—Ç–∏—Å—è –∑ 4 —Å–∏–º–≤–æ–ª—ñ–≤');
                return;
            }

            const roomData = await loadRoomData(roomCode);
            
            if (!roomData) {
                alert('–ö—ñ–º–Ω–∞—Ç—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                return;
            }

            if (roomData.gameStarted) {
                alert('–ì—Ä–∞ –≤ —Ü—ñ–π –∫—ñ–º–Ω–∞—Ç—ñ –≤–∂–µ –ø–æ—á–∞–ª–∞—Å—è');
                return;
            }

            gameState.roomCode = roomCode;
            gameState.playerId = Date.now().toString();
            gameState.isHost = false;
            gameState.scenario = roomData.scenario;
            gameState.bunkerCapacity = roomData.bunkerCapacity;
            gameState.players = roomData.players;
            gameState.discussionTime = roomData.discussionTime;
            
            gameState.currentPlayer = {
                id: gameState.playerId,
                name: playerName,
                character: generateCharacter(),
                isHost: false,
                eliminated: false
            };
            
            gameState.players.push(gameState.currentPlayer);
            await saveRoomData();
            
            updateLobby();
            showScreen('lobbyScreen');
            startPolling();
        }

        // Polling –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
        let pollingInterval = null;
        function startPolling() {
            if (pollingInterval) clearInterval(pollingInterval);
            
            pollingInterval = setInterval(async () => {
                const roomData = await loadRoomData(gameState.roomCode);
                if (roomData) {
                    const myPlayer = gameState.currentPlayer;
                    gameState.players = roomData.players;
                    gameState.phase = roomData.phase;
                    gameState.timerStartTime = roomData.timerStartTime;
                    gameState.timerDuration = roomData.timerDuration;
                    gameState.messages = roomData.messages || [];
                    gameState.votingResults = roomData.votingResults || {};
                    gameState.finalStory = roomData.finalStory;
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ —Å–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                    const updatedPlayer = gameState.players.find(p => p.id === myPlayer.id);
                    if (updatedPlayer) {
                        gameState.currentPlayer = updatedPlayer;
                    }

                    if (roomData.gameStarted && !gameState.gameStarted) {
                        gameState.gameStarted = true;
                        gameState.timerStartTime = roomData.timerStartTime;
                        showGameScreen();
                        startTimerUpdate();
                    }

                    if (gameState.gameStarted) {
                        if (gameState.phase === 'end') {
                            clearInterval(pollingInterval);
                            endGame();
                        } else {
                            updateGameScreen();
                            updateChat();
                        }
                    } else {
                        updateLobby();
                    }
                }
            }, 2000);
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª–æ–±—ñ
        function updateLobby() {
            document.getElementById('roomCodeDisplay').textContent = gameState.roomCode;
            
            const shareLink = window.location.href.split('?')[0] + '?room=' + gameState.roomCode;
            document.getElementById('shareLinkInput').value = shareLink;
            
            const maxPlayers = gameState.bunkerCapacity * 2;
            document.getElementById('playerCountDisplay').textContent = 
                `–ì—Ä–∞–≤—Ü—ñ–≤: ${gameState.players.length} / ${maxPlayers}`;
            
            const playerList = document.getElementById('lobbyPlayerList');
            playerList.innerHTML = '';
            
            gameState.players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-item' + (player.isHost ? ' host' : '');
                playerDiv.textContent = player.name;
                playerList.appendChild(playerDiv);
            });

            const actionsDiv = document.getElementById('lobbyActions');
            actionsDiv.innerHTML = '';
            
            if (gameState.isHost) {
                const startBtn = document.createElement('button');
                startBtn.className = 'btn btn-success';
                startBtn.textContent = '–ü–æ—á–∞—Ç–∏ –≥—Ä—É';
                startBtn.onclick = startGame;
                startBtn.disabled = gameState.players.length < 4;
                actionsDiv.appendChild(startBtn);
            }
            
            const leaveBtn = document.createElement('button');
            leaveBtn.className = 'btn btn-danger';
            leaveBtn.textContent = '–í–∏–π—Ç–∏ –∑ –∫—ñ–º–Ω–∞—Ç–∏';
            leaveBtn.onclick = () => location.reload();
            actionsDiv.appendChild(leaveBtn);
        }

        // –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è
        window.copyShareLink = function() {
            const input = document.getElementById('shareLinkInput');
            input.select();
            document.execCommand('copy');
            alert('–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ! –ü–æ–¥—ñ–ª–∏—Å—å –Ω–∏–º –∑ –¥—Ä—É–∑—è–º–∏');
        }

        // –ü–æ—á–∞—Ç–æ–∫ –≥—Ä–∏
        async function startGame() {
            if (!gameState.isHost) return;
            
            gameState.gameStarted = true;
            gameState.phase = 'discussion'; // –û–¥—Ä–∞–∑—É –ø–æ—á–∏–Ω–∞—î–º–æ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è
            gameState.messages = [];
            gameState.timerStartTime = Date.now();
            gameState.timerDuration = gameState.discussionTime * 60;
            
            await saveRoomData();
            addSystemMessage(`–ì—Ä–∞ –ø–æ—á–∞–ª–∞—Å—è! –£ –≤–∞—Å —î ${gameState.discussionTime} —Ö–≤–∏–ª–∏–Ω –Ω–∞ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è. –†–æ–∑–∫—Ä–∏–≤–∞–π—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–Ω–æ–ø–æ–∫!`);
            await saveRoomData();
            
            showGameScreen();
            startTimerUpdate();
        }

        // –ü–æ–∫–∞–∑ —ñ–≥—Ä–æ–≤–æ–≥–æ –µ–∫—Ä–∞–Ω—É
        function showGameScreen() {
            showScreen('gameScreen');
            updateGameScreen();
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–≥—Ä–æ–≤–æ–≥–æ –µ–∫—Ä–∞–Ω—É
        function updateGameScreen() {
            const phaseNames = {
                'discussion': '–û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è',
                'voting': '–ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è',
                'results': '–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è',
                'end': '–ö—ñ–Ω–µ—Ü—å –≥—Ä–∏'
            };
            
            document.getElementById('phaseIndicator').textContent = phaseNames[gameState.phase] || '–ì—Ä–∞';

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ü–µ–Ω–∞—Ä—ñ—é
            const scenarioCard = document.getElementById('scenarioCard');
            scenarioCard.innerHTML = `
                <div class="scenario-title">${gameState.scenario.name}</div>
                <div class="scenario-desc">${gameState.scenario.description}</div>
            `;

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ñ–æ –ø—Ä–æ –±—É–Ω–∫–µ—Ä
            const bunkerInfo = document.getElementById('bunkerInfo');
            const alivePlayers = gameState.players.filter(p => !p.eliminated).length;
            bunkerInfo.innerHTML = `
                <div class="bunker-stat">
                    <div class="bunker-stat-value">${gameState.bunkerCapacity}</div>
                    <div class="bunker-stat-label">–ú—ñ—Å—Ü—å –≤ –±—É–Ω–∫–µ—Ä—ñ</div>
                </div>
                <div class="bunker-stat">
                    <div class="bunker-stat-value">${alivePlayers}</div>
                    <div class="bunker-stat-label">–ì—Ä–∞–≤—Ü—ñ–≤ –∂–∏–≤—ñ</div>
                </div>
                <div class="bunker-stat">
                    <div class="bunker-stat-value">${gameState.scenario.duration}</div>
                    <div class="bunker-stat-label">–ß–∞—Å –≤ –±—É–Ω–∫–µ—Ä—ñ</div>
                </div>
            `;

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞–π–º–µ—Ä–∞
            if (gameState.phase === 'discussion' && gameState.timerStartTime) {
                document.getElementById('timerContainer').style.display = 'block';
                updateTimerDisplay();
            } else {
                document.getElementById('timerContainer').style.display = 'none';
            }

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            updateCharacterCard();
            
            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—à–∏—Ö –≥—Ä–∞–≤—Ü—ñ–≤
            updateOtherPlayers();
            
            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è
            if (gameState.phase === 'voting') {
                showVoting();
            } else {
                document.getElementById('votingSection').style.display = 'none';
            }
            
            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–Ω–æ–ø–æ–∫ –¥—ñ–π
            updateGameActions();
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        function updateCharacterCard() {
            const char = gameState.currentPlayer.character;
            const card = document.getElementById('characterCard');
            
            if (!gameState.currentPlayer.revealedChars) {
                gameState.currentPlayer.revealedChars = [];
            }
            
            const characteristics = [
                { id: 'gender', label: '–°—Ç–∞—Ç—å', value: char.gender },
                { id: 'age', label: '–í—ñ–∫', value: `${char.age} —Ä–æ–∫—ñ–≤` },
                { id: 'health', label: '–ó–¥–æ—Ä–æ–≤\'—è', value: char.health },
                { id: 'hobby', label: '–•–æ–±—ñ', value: char.hobby },
                { id: 'baggage', label: '–ë–∞–≥–∞–∂', value: char.baggage },
                { id: 'phobia', label: '–§–æ–±—ñ—è', value: char.phobia },
                { id: 'trait', label: '–†–∏—Å–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—É', value: char.trait },
                { id: 'additional', label: '–î–æ–¥–∞—Ç–∫–æ–≤–æ', value: char.additional }
            ];

            card.innerHTML = characteristics.map(c => {
                const revealed = gameState.currentPlayer.revealedChars.includes(c.id);
                return `
                    <div class="characteristic">
                        <div class="characteristic-label">${c.label}:</div>
                        <div class="characteristic-value ${revealed ? '' : 'hidden'}" style="display: flex; align-items: center; gap: 10px;">
                            <span style="flex: 1;">${revealed ? c.value : '???'}</span>
                            ${!revealed && gameState.phase !== 'end' ? `<button class="btn" style="padding: 5px 15px; font-size: 0.85rem;" onclick="window.revealCharacteristic('${c.id}')">–†–æ–∑–∫—Ä–∏—Ç–∏</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—à–∏—Ö –≥—Ä–∞–≤—Ü—ñ–≤
        function updateOtherPlayers() {
            const container = document.getElementById('otherPlayersContainer');
            const otherPlayers = gameState.players.filter(p => p.id !== gameState.currentPlayer.id);
            
            container.innerHTML = otherPlayers.map(player => {
                const char = player.character;
                const revealedChars = player.revealedChars || [];
                
                const characteristics = [
                    { id: 'gender', label: '–°—Ç–∞—Ç—å', value: char.gender },
                    { id: 'age', label: '–í—ñ–∫', value: `${char.age} —Ä–æ–∫—ñ–≤` },
                    { id: 'health', label: '–ó–¥–æ—Ä–æ–≤\'—è', value: char.health },
                    { id: 'hobby', label: '–•–æ–±—ñ', value: char.hobby },
                    { id: 'baggage', label: '–ë–∞–≥–∞–∂', value: char.baggage },
                    { id: 'phobia', label: '–§–æ–±—ñ—è', value: char.phobia },
                    { id: 'trait', label: '–†–∏—Å–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—É', value: char.trait },
                    { id: 'additional', label: '–î–æ–¥–∞—Ç–∫–æ–≤–æ', value: char.additional }
                ];

                return `
                    <div class="character-card ${player.eliminated ? 'eliminated' : ''}">
                        <h4 style="color: var(--accent); margin-bottom: 15px; text-align: center;">
                            ${player.name} - <span style="color: var(--primary);">${char.profession}</span>
                            ${player.eliminated ? '<span style="color: var(--danger);"> (–í–∏–∫–ª—é—á–µ–Ω–∏–π)</span>' : ''}
                        </h4>
                        ${characteristics.map(c => {
                            const revealed = revealedChars.includes(c.id);
                            return `
                                <div class="characteristic">
                                    <div class="characteristic-label">${c.label}:</div>
                                    <div class="characteristic-value ${revealed ? '' : 'hidden'}">
                                        ${revealed ? c.value : '???'}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }).join('');
        }

        // –†–æ–∑–∫—Ä–∏—Ç—Ç—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
        window.revealCharacteristic = async function(charId) {
            if (!gameState.currentPlayer.revealedChars) {
                gameState.currentPlayer.revealedChars = [];
            }
            
            if (!gameState.currentPlayer.revealedChars.includes(charId)) {
                gameState.currentPlayer.revealedChars.push(charId);
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –≥—Ä–∞–≤—Ü—è –≤ —Å–ø–∏—Å–∫—É
                const playerIndex = gameState.players.findIndex(p => p.id === gameState.currentPlayer.id);
                if (playerIndex !== -1) {
                    gameState.players[playerIndex] = gameState.currentPlayer;
                }
                
                await saveRoomData();
                
                const charNames = {
                    'gender': '—Å—Ç–∞—Ç—å',
                    'age': '–≤—ñ–∫',
                    'health': '–∑–¥–æ—Ä–æ–≤\'—è',
                    'hobby': '—Ö–æ–±—ñ',
                    'baggage': '–±–∞–≥–∞–∂',
                    'phobia': '—Ñ–æ–±—ñ—é',
                    'trait': '—Ä–∏—Å—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä—É',
                    'additional': '–¥–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é'
                };
                
                addSystemMessage(`${gameState.currentPlayer.name} —Ä–æ–∑–∫—Ä–∏–≤ ${charNames[charId]}`);
                await saveRoomData();
                updateCharacterCard();
            }
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–Ω–æ–ø–æ–∫ –¥—ñ–π
        function updateGameActions() {
            const actionsDiv = document.getElementById('gameActions');
            actionsDiv.innerHTML = '';

            if (gameState.phase === 'reveal' && gameState.isHost) {
                const discussBtn = document.createElement('button');
                discussBtn.className = 'btn btn-success';
                discussBtn.textContent = '–ü–æ—á–∞—Ç–∏ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è';
                discussBtn.onclick = startDiscussion;
                actionsDiv.appendChild(discussBtn);
            }

            if (gameState.phase === 'discussion' && gameState.isHost) {
                const voteBtn = document.createElement('button');
                voteBtn.className = 'btn btn-danger';
                voteBtn.textContent = '–ü–æ—á–∞—Ç–∏ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è';
                voteBtn.onclick = startVoting;
                actionsDiv.appendChild(voteBtn);

                const eventBtn = document.createElement('button');
                eventBtn.className = 'btn btn-secondary';
                eventBtn.textContent = '–í–∏–ø–∞–¥–∫–æ–≤–∞ –ø–æ–¥—ñ—è';
                eventBtn.onclick = triggerRandomEvent;
                actionsDiv.appendChild(eventBtn);
            }
        }

        // –ü–æ—á–∞—Ç–æ–∫ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è
        async function startDiscussion() {
            gameState.phase = 'discussion';
            gameState.timerStartTime = Date.now();
            gameState.timerDuration = gameState.discussionTime * 60;
            
            await saveRoomData();
            
            addSystemMessage(`–û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—á–∞–ª–æ—Å—è! –£ –≤–∞—Å —î ${gameState.discussionTime} —Ö–≤–∏–ª–∏–Ω`);
            updateGameScreen();
            startTimerUpdate();
        }

        // –¢–∞–π–º–µ—Ä
        let timerUpdateInterval = null;
        function startTimerUpdate() {
            if (timerUpdateInterval) clearInterval(timerUpdateInterval);
            
            timerUpdateInterval = setInterval(() => {
                if (gameState.phase !== 'discussion') {
                    clearInterval(timerUpdateInterval);
                    return;
                }
                
                updateTimerDisplay();
                
                const elapsed = Math.floor((Date.now() - gameState.timerStartTime) / 1000);
                const remaining = gameState.timerDuration - elapsed;
                
                if (remaining <= 0 && gameState.isHost) {
                    clearInterval(timerUpdateInterval);
                    startVoting();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const elapsed = Math.floor((Date.now() - gameState.timerStartTime) / 1000);
            const remaining = Math.max(0, gameState.timerDuration - elapsed);
            
            const minutes = Math.floor(remaining / 60);
            const seconds = remaining % 60;
            const display = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            const timerEl = document.getElementById('gameTimer');
            timerEl.textContent = display;
            
            timerEl.classList.remove('warning', 'critical');
            if (remaining <= 30) {
                timerEl.classList.add('critical');
            } else if (remaining <= 60) {
                timerEl.classList.add('warning');
            }
        }

        // –ß–∞—Ç
        window.sendMessage = async function() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            gameState.messages.push({
                author: gameState.currentPlayer.name,
                text: message,
                timestamp: Date.now()
            });
            
            await saveRoomData();
            input.value = '';
        }

        function addSystemMessage(text) {
            gameState.messages.push({
                author: '–°–ò–°–¢–ï–ú–ê',
                text: text,
                timestamp: Date.now(),
                isSystem: true
            });
        }

        function updateChat() {
            const messagesDiv = document.getElementById('chatMessages');
            const shouldScroll = messagesDiv.scrollHeight - messagesDiv.scrollTop === messagesDiv.clientHeight;
            
            messagesDiv.innerHTML = gameState.messages.map(msg => `
                <div class="chat-message ${msg.isSystem ? 'system' : ''}">
                    <div class="chat-message-author">${msg.author}</div>
                    <div class="chat-message-text">${msg.text}</div>
                </div>
            `).join('');
            
            if (shouldScroll) {
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }
        }

        // –ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è
        async function startVoting() {
            gameState.phase = 'voting';
            gameState.votingResults = {};
            
            await saveRoomData();
            addSystemMessage('–ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –ø–æ—á–∞–ª–æ—Å—è! –û–±–µ—Ä—ñ—Ç—å –≥—Ä–∞–≤—Ü—è –¥–ª—è –≤–∏–∫–ª—é—á–µ–Ω–Ω—è');
            showVoting();
        }

        function showVoting() {
            document.getElementById('votingSection').style.display = 'block';
            document.getElementById('timerContainer').style.display = 'none';
            
            const voteContainer = document.getElementById('voteContainer');
            const alivePlayers = gameState.players.filter(p => !p.eliminated && p.id !== gameState.currentPlayer.id);
            
            const hasVoted = gameState.votingResults[gameState.currentPlayer.id];
            document.getElementById('submitVoteBtn').disabled = hasVoted;
            
            voteContainer.innerHTML = alivePlayers.map(player => `
                <div class="vote-option ${gameState.currentVote === player.id ? 'selected' : ''}" 
                     data-player-id="${player.id}" 
                     onclick="window.selectVote('${player.id}')">
                    <div style="font-size: 1.3rem; font-weight: 500; margin-bottom: 5px;">${player.name}</div>
                    <div style="font-size: 0.9rem; color: var(--metal);">${player.character.profession}</div>
                </div>
            `).join('');
            
            if (hasVoted) {
                const resultDiv = document.getElementById('voteResultsContainer');
                resultDiv.innerHTML = `
                    <div class="status-message info">
                        –í–∏ –≤–∂–µ –ø—Ä–æ–≥–æ–ª–æ—Å—É–≤–∞–ª–∏. –û—á—ñ–∫—É—î–º–æ —ñ–Ω—à–∏—Ö –≥—Ä–∞–≤—Ü—ñ–≤...
                    </div>
                `;
            }
        }

        window.selectVote = function(playerId) {
            if (gameState.votingResults[gameState.currentPlayer.id]) return;
            
            gameState.currentVote = playerId;
            
            document.querySelectorAll('.vote-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            const selected = document.querySelector(`[data-player-id="${playerId}"]`);
            if (selected) {
                selected.classList.add('selected');
            }
        }

        window.submitVote = async function() {
            if (!gameState.currentVote) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –≥—Ä–∞–≤—Ü—è –¥–ª—è –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è');
                return;
            }

            if (gameState.votingResults[gameState.currentPlayer.id]) {
                alert('–í–∏ –≤–∂–µ –ø—Ä–æ–≥–æ–ª–æ—Å—É–≤–∞–ª–∏');
                return;
            }

            gameState.votingResults[gameState.currentPlayer.id] = gameState.currentVote;
            await saveRoomData();
            
            document.getElementById('submitVoteBtn').disabled = true;
            
            const resultDiv = document.getElementById('voteResultsContainer');
            resultDiv.innerHTML = `
                <div class="status-message info">
                    –í–∞—à –≥–æ–ª–æ—Å –ø—Ä–∏–π–Ω—è—Ç–æ! –û—á—ñ–∫—É—î–º–æ —ñ–Ω—à–∏—Ö –≥—Ä–∞–≤—Ü—ñ–≤...
                </div>
            `;

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –≤—Å—ñ –ø—Ä–æ–≥–æ–ª–æ—Å—É–≤–∞–ª–∏
            if (gameState.isHost) {
                checkVotingComplete();
            }
        }

        async function checkVotingComplete() {
            const alivePlayers = gameState.players.filter(p => !p.eliminated);
            const votedCount = Object.keys(gameState.votingResults).length;
            
            if (votedCount >= alivePlayers.length) {
                // –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –≥–æ–ª–æ—Å—ñ–≤
                const votes = {};
                Object.values(gameState.votingResults).forEach(playerId => {
                    votes[playerId] = (votes[playerId] || 0) + 1;
                });

                // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –≥—Ä–∞–≤—Ü—è –∑ –Ω–∞–π–±—ñ–ª—å—à–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –≥–æ–ª–æ—Å—ñ–≤
                let maxVotes = 0;
                let eliminatedPlayerId = null;
                Object.entries(votes).forEach(([playerId, count]) => {
                    if (count > maxVotes) {
                        maxVotes = count;
                        eliminatedPlayerId = playerId;
                    }
                });

                if (eliminatedPlayerId) {
                    const player = gameState.players.find(p => p.id === eliminatedPlayerId);
                    if (player) {
                        player.eliminated = true;
                        
                        // –ì–µ–Ω–µ—Ä—É—î–º–æ AI-—Å—Ü–µ–Ω–∞—Ä—ñ–π –≤–∏–∫–ª—é—á–µ–Ω–Ω—è
                        const eliminationStory = await generateEliminationStory(player, gameState);
                        addSystemMessage(`${player.name} –≤–∏–∫–ª—é—á–µ–Ω–∏–π –∑ –±—É–Ω–∫–µ—Ä—É! (${maxVotes} –≥–æ–ª–æ—Å—ñ–≤)`);
                        addSystemMessage(eliminationStory);
                        
                        // –ü–æ–∫–∞–∑—É—î–º–æ –¥—Ä–∞–º–∞—Ç–∏—á–Ω—É —Å—Ü–µ–Ω—É
                        showEvent('üíÄ –í–ò–ö–õ–Æ–ß–ï–ù–ù–Ø', eliminationStory);
                    }
                }

                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫—ñ–Ω—Ü—è –≥—Ä–∏
                const alive = gameState.players.filter(p => !p.eliminated).length;
                if (alive <= gameState.bunkerCapacity) {
                    gameState.phase = 'end';
                    await saveRoomData();
                    
                    // –ì–µ–Ω–µ—Ä—É—î–º–æ —Ñ—ñ–Ω–∞–ª—å–Ω—É —ñ—Å—Ç–æ—Ä—ñ—é
                    setTimeout(async () => {
                        const finalStory = await generateFinalStory(gameState);
                        gameState.finalStory = finalStory;
                        await saveRoomData();
                        endGame();
                    }, 3000);
                } else {
                    // –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è
                    gameState.phase = 'discussion';
                    gameState.timerStartTime = Date.now();
                    gameState.votingResults = {};
                    await saveRoomData();
                    addSystemMessage('–ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è');
                }
            }
        }

        // AI –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —ñ—Å—Ç–æ—Ä—ñ—ó –≤–∏–∫–ª—é—á–µ–Ω–Ω—è
        async function generateEliminationStory(player, state) {
            try {
                const alivePlayers = state.players.filter(p => !p.eliminated && p.id !== player.id);
                const playersInfo = alivePlayers.map(p => `${p.name} (${p.character.profession})`).join(', ');
                
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 1000,
                        messages: [
                            { 
                                role: "user", 
                                content: `–¢–∏ - —Ä–æ–∑–ø–æ–≤—ñ–¥–∞—á –ø–æ—Å—Ç–∞–ø–æ–∫–∞–ª—ñ–ø—Ç–∏—á–Ω–æ—ó –≥—Ä–∏ "–ë—É–Ω–∫–µ—Ä". 

–°—Ü–µ–Ω–∞—Ä—ñ–π: ${state.scenario.name} - ${state.scenario.description}
–í–∏–∫–ª—é—á–µ–Ω–∏–π –≥—Ä–∞–≤–µ—Ü—å: ${player.name} (${player.character.profession}, ${player.character.age} —Ä–æ–∫—ñ–≤, ${player.character.gender})
–ó–∞–ª–∏—à–∏–ª–∏—Å—è –≤ –±—É–Ω–∫–µ—Ä—ñ: ${playersInfo}

–ù–∞–ø–∏—à–∏ –ö–û–†–û–¢–ö–£ (2-3 —Ä–µ—á–µ–Ω–Ω—è) –¥—Ä–∞–º–∞—Ç–∏—á–Ω—É —Å—Ü–µ–Ω—É –≤–∏–∫–ª—é—á–µ–Ω–Ω—è —Ü—å–æ–≥–æ –≥—Ä–∞–≤—Ü—è –∑ –±—É–Ω–∫–µ—Ä—É. –û–ø–∏—à–∏ –º–æ–º–µ–Ω—Ç, –∫–æ–ª–∏ –π–æ–≥–æ –≤–∏–≤–æ–¥—è—Ç—å –∑ –±—É–Ω–∫–µ—Ä—É –≤ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–π –∑–æ–≤–Ω—ñ—à–Ω—ñ–π —Å–≤—ñ—Ç. –ë—É–¥—å –µ–º–æ—Ü—ñ–π–Ω–∏–º —Ç–∞ –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–∏–º. –ü–∏—à–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é.`
                            }
                        ]
                    })
                });

                const data = await response.json();
                const story = data.content.find(c => c.type === 'text')?.text || 
                    `${player.name} –≤–∞–∂–∫–∏–º–∏ –∫—Ä–æ–∫–∞–º–∏ –π–¥–µ –¥–æ –≤–∏—Ö–æ–¥—É –∑ –±—É–Ω–∫–µ—Ä—É. –ì–µ—Ä–º–µ—Ç–∏—á–Ω—ñ –¥–≤–µ—Ä—ñ –≤—ñ–¥—á–∏–Ω—è—é—Ç—å—Å—è –∑ –≥—É—á–Ω–∏–º —Å–≤–∏—Å—Ç–æ–º, —ñ –Ω–∞–∑–æ–≤–Ω—ñ –≤–∏–¥–Ω–æ –ª–∏—à–µ —Ç–µ–º—Ä—è–≤—É —Ç–∞ —Ä—É—ó–Ω–∏. –î–≤–µ—Ä—ñ –∑–∞—á–∏–Ω—è—é—Ç—å—Å—è –∑–∞ –Ω–∏–º –Ω–∞–∑–∞–≤–∂–¥–∏...`;
                
                return story;
            } catch (e) {
                console.error('AI generation failed:', e);
                return `${player.name} –≤–∞–∂–∫–∏–º–∏ –∫—Ä–æ–∫–∞–º–∏ –π–¥–µ –¥–æ –≤–∏—Ö–æ–¥—É –∑ –±—É–Ω–∫–µ—Ä—É. –ì–µ—Ä–º–µ—Ç–∏—á–Ω—ñ –¥–≤–µ—Ä—ñ –≤—ñ–¥—á–∏–Ω—è—é—Ç—å—Å—è –∑ –≥—É—á–Ω–∏–º —Å–≤–∏—Å—Ç–æ–º, —ñ –Ω–∞–∑–æ–≤–Ω—ñ –≤–∏–¥–Ω–æ –ª–∏—à–µ —Ç–µ–º—Ä—è–≤—É —Ç–∞ —Ä—É—ó–Ω–∏. –î–≤–µ—Ä—ñ –∑–∞—á–∏–Ω—è—é—Ç—å—Å—è –∑–∞ –Ω–∏–º –Ω–∞–∑–∞–≤–∂–¥–∏...`;
            }
        }

        // AI –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ñ—ñ–Ω–∞–ª—å–Ω–æ—ó —ñ—Å—Ç–æ—Ä—ñ—ó
        async function generateFinalStory(state) {
            try {
                const winners = state.players.filter(p => !p.eliminated);
                const winnersInfo = winners.map(p => 
                    `${p.name} (${p.character.profession}, ${p.character.age} —Ä–æ–∫—ñ–≤, ${p.character.gender})`
                ).join(', ');
                
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 1000,
                        messages: [
                            { 
                                role: "user", 
                                content: `–¢–∏ - —Ä–æ–∑–ø–æ–≤—ñ–¥–∞—á –ø–æ—Å—Ç–∞–ø–æ–∫–∞–ª—ñ–ø—Ç–∏—á–Ω–æ—ó –≥—Ä–∏ "–ë—É–Ω–∫–µ—Ä". 

–°—Ü–µ–Ω–∞—Ä—ñ–π: ${state.scenario.name} - ${state.scenario.description}
–ß–∞—Å –≤ –±—É–Ω–∫–µ—Ä—ñ: ${state.scenario.duration}
–í–∏–∂–∏–≤—à—ñ: ${winnersInfo}

–ù–∞–ø–∏—à–∏ –ö–û–†–û–¢–ö–£ (3-5 —Ä–µ—á–µ–Ω—å) –µ–ø—ñ—á–Ω—É –∫—ñ–Ω—Ü—ñ–≤–∫—É –ø—Ä–æ —Ç–µ, —è–∫ —Ü—ñ –ª—é–¥–∏ –≤–∏–∂–∏–ª–∏ –≤ –±—É–Ω–∫–µ—Ä—ñ —Ç–∞ —â–æ —Å—Ç–∞–ª–æ—Å—è –ø—ñ—Å–ª—è –≤–∏—Ö–æ–¥—É. –ß–∏ –∑–º–æ–≥–ª–∏ –≤–æ–Ω–∏ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ —Ü–∏–≤—ñ–ª—ñ–∑–∞—Ü—ñ—é? –Ø–∫ —ó—Ö–Ω—ñ –ø—Ä–æ—Ñ–µ—Å—ñ—ó —Ç–∞ –Ω–∞–≤–∏—á–∫–∏ –¥–æ–ø–æ–º–æ–≥–ª–∏? –ë—É–¥—å –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∏–º –∞–±–æ —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–º –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ —Å–∫–ª–∞–¥—É –∫–æ–º–∞–Ω–¥–∏. –ü–∏—à–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é.`
                            }
                        ]
                    })
                });

                const data = await response.json();
                const story = data.content.find(c => c.type === 'text')?.text || 
                    `–ü—ñ—Å–ª—è ${state.scenario.duration} –≤ –±—É–Ω–∫–µ—Ä—ñ, –≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ –¥–≤–µ—Ä—ñ –Ω–∞—Ä–µ—à—Ç—ñ –≤—ñ–¥—á–∏–Ω–∏–ª–∏—Å—è. –°–≤—ñ—Ç –∑–º—ñ–Ω–∏–≤—Å—è –Ω–∞–∑–∞–≤–∂–¥–∏, –∞–ª–µ –≤–∏–∂–∏–≤—à—ñ –±—É–ª–∏ –≥–æ—Ç–æ–≤—ñ –¥–æ –Ω–æ–≤–æ–≥–æ –ø–æ—á–∞—Ç–∫—É. –ó–∞–≤–¥—è–∫–∏ —Å–≤–æ—ó–º –Ω–∞–≤–∏—á–∫–∞–º —Ç–∞ –∑–≥—É—Ä—Ç–æ–≤–∞–Ω–æ—Å—Ç—ñ, –≤–æ–Ω–∏ —Å—Ç–∞–ª–∏ –æ—Å–Ω–æ–≤–æ—é –Ω–æ–≤–æ—ó —Ü–∏–≤—ñ–ª—ñ–∑–∞—Ü—ñ—ó.`;
                
                return story;
            } catch (e) {
                console.error('AI generation failed:', e);
                return `–ü—ñ—Å–ª—è ${state.scenario.duration} –≤ –±—É–Ω–∫–µ—Ä—ñ, –≥–µ—Ä–º–µ—Ç–∏—á–Ω—ñ –¥–≤–µ—Ä—ñ –Ω–∞—Ä–µ—à—Ç—ñ –≤—ñ–¥—á–∏–Ω–∏–ª–∏—Å—è. –°–≤—ñ—Ç –∑–º—ñ–Ω–∏–≤—Å—è –Ω–∞–∑–∞–≤–∂–¥–∏, –∞–ª–µ –≤–∏–∂–∏–≤—à—ñ –±—É–ª–∏ –≥–æ—Ç–æ–≤—ñ –¥–æ –Ω–æ–≤–æ–≥–æ –ø–æ—á–∞—Ç–∫—É. –ó–∞–≤–¥—è–∫–∏ —Å–≤–æ—ó–º –Ω–∞–≤–∏—á–∫–∞–º —Ç–∞ –∑–≥—É—Ä—Ç–æ–≤–∞–Ω–æ—Å—Ç—ñ, –≤–æ–Ω–∏ —Å—Ç–∞–ª–∏ –æ—Å–Ω–æ–≤–æ—é –Ω–æ–≤–æ—ó —Ü–∏–≤—ñ–ª—ñ–∑–∞—Ü—ñ—ó.`;
            }
        }

        // –í–∏–ø–∞–¥–∫–æ–≤–∞ –ø–æ–¥—ñ—è
        window.triggerRandomEvent = async function() {
            // –ì–µ–Ω–µ—Ä—É—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω—É –ø–æ–¥—ñ—é —á–µ—Ä–µ–∑ AI
            const aiEvent = await generateRandomEvent(gameState);
            showEvent(aiEvent.title, aiEvent.description);
            addSystemMessage(`–ü–æ–¥—ñ—è: ${aiEvent.title}`);
            await saveRoomData();
        }

        // AI –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –≤–∏–ø–∞–¥–∫–æ–≤–æ—ó –ø–æ–¥—ñ—ó
        async function generateRandomEvent(state) {
            try {
                const alivePlayers = state.players.filter(p => !p.eliminated);
                const playersInfo = alivePlayers.map(p => `${p.name} (${p.character.profession})`).join(', ');
                
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 1000,
                        messages: [
                            { 
                                role: "user", 
                                content: `–¢–∏ - –º–∞–π—Å—Ç–µ—Ä –≥—Ä–∏ –≤ –ø–æ—Å—Ç–∞–ø–æ–∫–∞–ª—ñ–ø—Ç–∏—á–Ω—É –≥—Ä—É "–ë—É–Ω–∫–µ—Ä". 

–°—Ü–µ–Ω–∞—Ä—ñ–π: ${state.scenario.name} - ${state.scenario.description}
–ì—Ä–∞–≤—Ü—ñ –≤ –±—É–Ω–∫–µ—Ä—ñ: ${playersInfo}

–ü—Ä–∏–¥—É–º–∞–π –£–ù–Ü–ö–ê–õ–¨–ù–£ –≤–∏–ø–∞–¥–∫–æ–≤—É –ø–æ–¥—ñ—é, —è–∫–∞ –º–æ–∂–µ —Å—Ç–∞—Ç–∏—Å—è –≤ –±—É–Ω–∫–µ—Ä—ñ. –¶–µ –º–∞—î –±—É—Ç–∏:
- –ù–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–∏–º –≤–∏–∫–ª–∏–∫–æ–º –∞–±–æ –ø—Ä–æ–±–ª–µ–º–æ—é
- –ü–æ–≤'—è–∑–∞–Ω–∏–º –∑—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—î–º –∞–ø–æ–∫–∞–ª—ñ–ø—Å–∏—Å—É
- –¢–∞–∫–∏–º, —â–æ —Å—Ç–≤–æ—Ä—é—î –¥–∏–ª–µ–º—É –∞–±–æ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç
- –ú–æ–∂–ª–∏–≤–æ, –ø–æ—Ç—Ä–µ–±—É—î –Ω–∞–≤–∏—á–æ–∫ –∫–æ–≥–æ—Å—å –∑ –≥—Ä–∞–≤—Ü—ñ–≤

–í—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞–¥–∞–π –¢–Ü–õ–¨–ö–ò —É —Ñ–æ—Ä–º–∞—Ç—ñ JSON –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç—É:
{
  "title": "–ö–æ—Ä–æ—Ç–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∑ –µ–º–æ–¥–∑—ñ",
  "description": "2-3 —Ä–µ—á–µ–Ω–Ω—è –æ–ø–∏—Å—É –ø–æ–¥—ñ—ó"
}

–ü–∏—à–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é.`
                            }
                        ]
                    })
                });

                const data = await response.json();
                const text = data.content.find(c => c.type === 'text')?.text || '';
                
                // –û—á–∏—â–∞—î–º–æ –≤—ñ–¥ markdown
                const jsonText = text.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                const event = JSON.parse(jsonText);
                
                return event;
            } catch (e) {
                console.error('AI event generation failed:', e);
                return randomElement(gameEvents);
            }
        }

        function showEvent(title, description) {
            document.getElementById('eventTitle').textContent = title;
            document.getElementById('eventDescription').textContent = description;
            document.getElementById('overlay').classList.add('show');
            document.getElementById('eventPopup').classList.add('show');
        }

        window.closeEvent = function() {
            document.getElementById('overlay').classList.remove('show');
            document.getElementById('eventPopup').classList.remove('show');
        }

        // –ö—ñ–Ω–µ—Ü—å –≥—Ä–∏
        function endGame() {
            showScreen('endScreen');
            
            const winners = gameState.players.filter(p => !p.eliminated);
            const winnersContainer = document.getElementById('winnersContainer');
            
            const finalStory = gameState.finalStory || '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –µ–ø—ñ–ª–æ–≥—É...';
            
            winnersContainer.innerHTML = `
                <div class="scenario-card" style="border-color: var(--bunker-green); background: linear-gradient(135deg, rgba(59, 186, 92, 0.2), rgba(76, 175, 80, 0.2));">
                    <div class="scenario-title" style="color: var(--bunker-green);">
                        üéâ –í–ò–ñ–ò–í–®–ò–•: ${winners.length}
                    </div>
                    <div class="scenario-desc" style="margin: 20px 0;">
                        ${winners.map(w => `
                            <div style="margin: 15px 0; padding: 15px; background: rgba(13, 13, 13, 0.4); border-radius: 8px; border-left: 4px solid var(--bunker-green);">
                                <div style="font-size: 1.4rem; font-weight: 500; color: var(--accent);">${w.name}</div>
                                <div style="font-size: 1.1rem; color: var(--bunker-green); margin-top: 5px;">${w.character.profession}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="card" style="margin-top: 30px; border: 3px solid var(--accent);">
                    <h3 style="color: var(--accent); margin-bottom: 20px; text-align: center; font-size: 1.8rem; font-family: 'Bebas Neue', cursive; letter-spacing: 3px;">üìñ –ï–ü–Ü–õ–û–ì</h3>
                    <div style="font-size: 1.15rem; line-height: 1.8; color: var(--light); text-align: center; padding: 20px;">
                        ${finalStory}
                    </div>
                </div>
            `;
        }

        // –û–±—Ä–æ–±–Ω–∏–∫ Enter –¥–ª—è —á–∞—Ç—É
        document.getElementById('chatInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                window.sendMessage();
            }
        });

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è
        const urlParams = new URLSearchParams(window.location.search);
        const roomParam = urlParams.get('room');
        if (roomParam) {
            document.getElementById('roomCodeInput').value = roomParam;
            showJoinRoom();
        }
    </script>
</body>
</html>
